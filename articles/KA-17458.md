---
title: Optimieren des  [!DNL Dispatcher] -Cache
description: Beschreibung
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/20/2021 7:12:29 PM
article-published-by: Cedric Latimier
article-published-date: 1/18/2022 1:45:44 PM
version-number: 1
article-number: KA-17458
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=ee6e74a7-d931-ec11-b6e5-000d3a5ba97a
exl-id: 84871fce-d53d-4a1d-aabf-ccf8c8c47810
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '1411'
ht-degree: 100%

---

# Optimieren des [!DNL Dispatcher]-Cache

## Beschreibung


Dieser Artikel konzentriert sich auf die neuesten Optimierungen im AEM Dispatcher und wie diese am besten genutzt werden können.  Der AEM Dispatcher ist ein zwischenspeichernder [Reverse-Proxy](https://stackoverflow.com/questions/224664/difference-between-proxy-server-and-reverse-proxy-server)-Server, der für die Verwendung mit Adobe Experience Manager entwickelt wurde.  Es kann als Modul in bestehender Webserver-Software installiert und ausgeführt werden.  Zum Zeitpunkt der Erstellung dieses Artikels wird das [Dispatcher-Modul](https://helpx.adobe.com/de/experience-manager/dispatcher/using/dispatcher-install.html) auf [!DNL Apache HTTP Server], Microsoft IIS und [!DNL iPlanet] unterstützt.


## Lösung

<br><br>Funktionsweise der Dispatcher-Zwischenspeicherung<br><br><br><br><br><br>
Auf der grundlegendsten Ebene ist der AEM Dispatcher ein Reverse-Proxy, der durch Zwischenspeicherung, Cache-Leerung und Cache-Invalidierung funktioniert.

Weitere Informationen zum Dispatcher finden Sie unter den entsprechenden Links:

1. [Funktionsweise des Dispatchers und Installation](https://helpx.adobe.com/de/experience-manager/dispatcher/using/dispatcher.html).
2. [Im Dispatcher verfügbare Konfigurationsoptionen](https://helpx.adobe.com/de/experience-manager/dispatcher/using/dispatcher-configuration.html).
3. [Webinar zur Funktionsweise des Dispatchers](https://github.com/cqsupport/webinar-dispatchercache) – Beachten Sie, dass einige Informationen in der Präsentation auf alten Versionen des Dispatchers basieren.
4. [Gems-Webinarsitzung zu Dispatcher-Funktionen, CDN-Nutzung und Sicherheit](https://docs.adobe.com/ddc/de/gems/dispatcher-caching---new-features-and-optimizations.html).
5. [Gems-Sitzung zu neuen Funktionen im Dispatcher (nach Version 4.1.9)](https://helpx.adobe.com/de/experience-manager/kt/eseminars/gems/aem-dispatcher.html).

<br><br><br><br><br><br>Optimieren des Dispatcher-Caches<br><br><br><br><br><br>
Im Folgenden finden Sie einige Möglichkeiten, den Dispatcher-Cache zu optimieren:

1. <b>Fast alles zwischenspeichern</b> – Dies bedeutet, dass alle Inhalte zwischengespeichert werden, die von Benutzern mehrmals angefragt werden.
2. <b>Personalisierte Inhalte für verschiedene Zeiträume zwischenspeichern</b> – Wenn Ihre Website personalisierte Inhalte hat, sollten Sie [[!DNL Apache Sling Dynamic Includes]](https://experienceleague.adobe.com/docs/experience-manager-learn/foundation/development/set-up-sling-dynamic-include.html?lang=de) in Ihrer AEM-Anwendung verwenden, um [!DNL Ajax] (asynchrone JavaScript- und XML-Aufrufe auf Browserebene), SSI (Server Side Includes auf Webserverebene) und ESI (Edge-side Includes auf CDN-Ebene) zu nutzen, um verschiedene Teile der Seite für verschiedene Zeiträume zwischenzuspeichern.
3. <b>Den Dispatcher-Cache auf einem Live-Dispatcher niemals löschen</b> – Wenn ein Dispatcher Live-Inhalte bereitstellt und Sie den Cache löschen, führt dies zu einer massiven Flut von Anfragen, die an AEM zurückgesendet werden.  Aus diesem Grund sollte der Dispatcher-Cache nie auf einem Live-Dispatcher gelöscht werden.
4. <b>Den Cache vorbereiten</b> – Bevor Sie den [!DNL Dispatcher]-Cache löschen, ziehen Sie den [!DNL Dispatcher] von Ihrem Load-Balancer ab, löschen Sie den Cache und lassen Sie dann ein Web-Crawler-Tool laufen, um Dateien auf dem Dispatcher zwischenzuspeichern, bevor Sie ihn auf den Lastenausgleich setzen.
5. <b>Cache-Fehlerseiten</b> – Nutzen Sie die <b>[DispatcherPassError 1](https://helpx.adobe.com/de/experience-manager/dispatcher/using/dispatcher-install.html#ApacheWebServer) </b>([!DNL Apache]-Webserver-spezifische)-Direktive, um Fehlerseiten wie 404s aus dem Dispatcher-Cache zu liefern.
6. <b>Alle Dateitypen mit Ausnahme der vorkomprimierten mit GZip komprimieren</b> – Im [!DNL Apache]-Webserver könnte [mod_deflate](https://httpd.apache.org/docs/2.4/mod/mod_deflate.html) verwendet werden, aber stellen Sie sicher, dass der <b>`Vary: User-Agent`-</b>Header<b> </b>nicht gesetzt ist.  Verwenden Sie in Microsoft IIS [Dynamische Komprimierung](https://docs.microsoft.com/de-de/iis/configuration/system.webserver/httpcompression/).

   [!DNL Apache]-Konfigurationsbeispiel (Angabe nur bestimmter Inhaltstypen, um vorkomprimierte Dateitypen zu vermeiden):

   `AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript`
7. <b>Aktivieren Sie [/serveStaleOnError](https://helpx.adobe.com/de/experience-manager/kb/ServeStaleContentOnError.html)</b> in der `/cache`-Konfiguration – Bereitstellung der alten Cache-Datei, wenn AEM-Instanzen Fehler liefern.
8. <b>Fügen Sie [/gracePeriod](https://docs.adobe.com/content/help/de/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html#configuring-the-dispatcher-cache-cache)</b> zur `/cache`-Konfiguration hinzu – legen Sie die Anzahl der Sekunden fest, die eine veraltete, automatisch für ungültig erklärte Ressource nach dem letzten Ereignis der Inhaltsveröffentlichung („Aktivierung“) noch aus dem Cache bedient werden darf.  Dadurch wird die Anzahl der Anfragen reduziert, die während einer umfangreichen Inhaltsveröffentlichungsaktivität wie z. B. „Baumstrukturaktivierung“an die Veröffentlichungsinstanzen zurückgesendet werden.
9. <b>Fügen Sie Regeln zu [/ignoreUrlParams](https://helpx.adobe.com/de/experience-manager/dispatcher/using/dispatcher-configuration.html#IgnoringURLParameters)</b> hinzu – Ignorieren Sie Abfragezeichenfolgen-Parameter, die von der Anwendung nicht benötigt oder verwendet werden.  Dies ermöglicht das Zwischenspeichern von URLs, selbst wenn eine Abfragezeichenfolge vorhanden ist.
10. <b>Zwischenspeichern der Antwort-Header „Cache-Steuerung“ und „Zuletzt geändert“</b> – Verwenden Sie die <b> [/headers](https://helpx.adobe.com/de/experience-manager/dispatcher/using/dispatcher-configuration.html#CachingHTTPResponseHeaders)</b>-Konfiguration, um die HTTP-Antwort-Header <b>`Cache-Control`</b> und <b>`Last-Modified` </b> (und/oder <b>`ETag`</b>-Header, wenn Sie sie von AEM aus senden) zwischenzuspeichern.  Dies hilft bei der Vereinfachung und Optimierung des Caching auf CDN- und Browser-Ebene.  Durch das Caching dieser Header werden die Header nur von AEM festgelegt, nicht vom Webserver selbst.  Beachten Sie, dass Sie in diesem Fall damit beginnen müssen, die Header aus Ihrer AEM-Anwendung zu senden.
11. <b>Inhalte so lange wie möglich zwischenspeichern</b> und <b>Reduzieren von Anfragen, die zurück an AEM gehen</b> – Optimieren Sie Löschanfragen, indem Sie das [Refetching Flush](https://helpx.adobe.com/experience-manager/kb/optimizing-the-dispatcher-cache.html#refetching-flush) für alle Löschagenten aktivieren.  Oder verwenden Sie [<b>/enableTTL</b>](https://helpx.adobe.com/experience-manager/kb/optimizing-the-dispatcher-cache.html#use-ttls) und setzen Sie den <b>`Cache-Control: max-age=...`</b>-Header so, dass Dateien so lange wie möglich zwischengespeichert werden.  Einzelheiten zu diesem Thema siehe [unten](https://helpx.adobe.com/experience-manager/kb/optimizing-the-dispatcher-cache.html#use-ttls).

<br><br><br><br><br><br>Verwenden von TTLs<br><br><br><br><br><br>
Ab [!DNL Dispatcher] Version 4.1.11 kann [/enableTTL 1](https://helpx.adobe.com/de/experience-manager/dispatcher/using/dispatcher-configuration.html#ConfiguringTimeBasedCacheInvalidationenableTTL) in der `.any`-Dateikonfiguration festgelegt werden.  Diese Einstellung bewirkt, dass der Dispatcher die im HTTP-`Cache-Control`-Antwort-Header festgelegten Cache-Ablaufzeiten beachtet.  Mit anderen Worten, der Dispatcher funktioniert ähnlich wie ein CDN, bei dem die primäre Form der Cache-Invalidierung auftritt, wenn Dateien ablaufen.  Sobald Sie dies implementiert haben und beginnen, <b>`Cache-Control: max-age=...` </b>für alle Antworten von AEM zu senden, können Sie Ihre Dispatcher-Löschagenten in den Veröffentlichungsinstanzen sicher deaktivieren.

Nachdem Sie die Löschagenten auf den Veröffentlichungsinstanzen deaktiviert haben, möchten Sie möglicherweise weiterhin den Dispatcher-Cache leeren können.  In diesem Fall können Sie die [ACS Commons – Dispatcher-Lösch-Benutzeroberfläche](https://adobe-consulting-services.github.io/acs-aem-commons/features/dispatcher-flush-ui/index.html) verwenden.  Dieses Tool ist auf der Autoreninstanz installiert.  Es bietet Benutzern eine Benutzeroberfläche, in der sie manuelle Cache-Löschanfragen ausführen können.

<b>I. Schritte zur Aktivierung von TTL („Time to Live“ oder Ablaufdatum)-ähnlichen Invalidierungen:</b>

1. Ändern Sie den Quellcode in der AEM-Anwendung, um die Header <b>`Cache-Control` </b>und <b>`Last-Modified`</b> für alle Anfragen zu senden, für die er nicht bereits festgelegt ist.
2. Installieren Sie [!DNL Dispatcher] 4.1.11 oder höher.
3. Setzen Sie <b>[/enableTTL 1](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#ConfiguringTimeBasedCacheInvalidationenableTTL)</b> in der `.any`-Farm-Konfiguration der Website.
4. Legen Sie in der<b>[/headers](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#CachingHTTPResponseHeaders)</b>-Konfiguration fest, dass die <b>`Cache-Control`</b>- und <b>`Last-Modified`</b>-Header zwischengespeichert werden.
5. Starten Sie den Webserver neu.


<b>II. Deaktivieren Sie Dispatcher-Löschagenten in den Veröffentlichungsinstanzen:</b>

Der Dispatcher verwendet nun den `Cache-Control`-Header, um die Invalidierung der Cache-Dateien zu steuern.  Da dies der Fall ist, ist eine Dispatcher-Leerung von den Veröffentlichungsinstanzen aus nicht mehr erforderlich.

1. Navigieren Sie auf jeder Veröffentlichungsinstanz zu `/etc/replication/agents.publish.html`.
2. Gehen Sie zur Konfiguration jedes Löschagenten und deaktivieren Sie den Agenten.


<b>III. Lassen Sie manuelle Dispatcher-Löschanfragen von der Autoreninstanz aus zu:</b>

Da die Löschagenten nun deaktiviert sind, müssen Sie sich ganz auf den <b>`Cache-Control`</b>-Header verlassen, um zu steuern, wann die Inhalte auf dem Dispatcher aktualisiert werden.  Sie können Benutzern weiterhin erlauben, manuelle Leerungen des Dispatcher-Caches auszuführen:

1. Installieren Sie die [ACS Commons – Dispatcher-Lösch-Benutzeroberfläche](https://adobe-consulting-services.github.io/acs-aem-commons/features/dispatcher-flush-ui/index.html) auf der Autoreninstanz.
2. Konfigurieren Sie die Löschagenten in der Autoreninstanz.
3. Setzen Sie in jeder Agentenkonfiguration die Option <b>Trigger</b> = <b>Standard ignorieren</b> auf „Aktiviert“. Diese Option bewirkt, dass die Löschagenten ignorieren, wenn Benutzer in der AEM-Benutzeroberfläche auf <b>Veröffentlichen (aufheben)</b> oder <b>Aktivieren (deaktivieren)</b> klicken.

<br><br><br><br><br><br>Neuabruf der Dispatcher-Leerung<br><br><br><br><br><br>
Um die Löschanfragen des Dispatchers zu optimieren, sollte für alle Dispatcher-Löschagenten eine Funktion namens „Neuabruf der Leerung“ aktiviert sein.

Um das erneute Abrufen der Dispatcher-Leerung zu aktivieren, gehen Sie wie folgt vor:

1. Navigieren Sie zu <b>*http://aemhost:port*/crx/packmgr/index.jsp</b> und melden Sie sich als Administrator an.
2. Laden Sie [hier](https://github.com/cqsupport/webinar-dispatchercache/blob/master/packages/dispatcher-flush-refetch-samplecode-1.0.zip?raw=true) das Paket herunter.
3. Laden Sie das Paket hoch und installieren Sie es in den Package Manager.
4. Gehen Sie zur Konfiguration des Dispatcher-Löschagenten. Beispiel: <b>/etc/replication/agents.author/flush.html</b>
5. Klicken Sie auf <b>[!UICONTROL Bearbeiten]</b>.
6. Legen Sie die folgenden Einstellungen fest.
   - <b>Serialisierungstyp</b> = <b>Neuabruf der Dispatcher-Leerung</b>
   - <b>Erweitert</b> = <b>HTTP-Methode</b> = <b>POST</b>
7. Klicken Sie auf <b>[!UICONTROL Speichern]</b>.


Beachten Sie, dass das oben installierte Paket nur ein einfaches Beispiel ist.  Um den erneuten Abruf der Leerung anzupassen und zu optimieren, können Sie die Liste der gesendeten URIs ändern.  Der Code ist Open Source und kann [hier](https://github.com/cqsupport/webinar-dispatchercache/tree/master/src/refetching-flush-agent/refetch-bundle) gefunden werden.  Der Code fügt dem Anfragetext eine Liste von URIs als Parameter hinzu, die dem Dispatcher mitteilen, welche Pfade erneut abgerufen werden sollen.  Sie können je nach Ihren Anwendungsanforderungen weitere Pfade hinzufügen, um die Caching-Funktionen Ihrer Website zu optimieren.
<br><br><br><br><br><br>Eine detailliertere Erklärung zum erneuten Abrufen der Leerung<br><br><br><br><br><br>
Normalerweise funktioniert eine Dispatcher-Leerung durch Löschen von Dateien:

1. `.stat` Datei(en) anfassen
2. `/content/foo.\*` löschen
3. `/content/foo/_jcr_content` löschen


Da die Dateien in Schritt 2 gelöscht werden, würden bei der nächsten Anfrage eines Benutzers nach einer Datei wie `/content/foo.html` oder `/content/foo.json`, während die Datei „erneut abgerufen“ wird, nachfolgende Anfragen nach derselben Datei ebenfalls an die Veröffentlichungsinstanzen gesendet, bis die Datei zwischengespeichert ist.  Bei langsamen Antworten oder Seiten mit hohem Traffic-Aufkommen wie Homepages kann dies zu Überflutungen der Veröffentlichungsinstanzebene führen.

Um dieses Problem zu beheben, aktivieren Sie eine Funktion des Dispatchers, die als Neuabruf bezeichnet wird.  Mit dieser Funktion können Sie eine Liste von URIs senden, die der Dispatcher proaktiv „erneut abrufen“ und ersetzen soll, anstatt sie zu löschen.

Unter 22:41-27:05 in dieser [Präsentationsaufzeichnung](https://my.adobeconnect.com/p7th2gf8k43) finden Sie eine Demonstration der Funktionsweise und der Konfiguration des Systems.
