---
title: "Fehler: Zu viele geöffnete Dateien"
description: Beschreibung
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: "KCS"
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: "10/20/2021 11:05:19 PM"
article-published-by: Roxann McGlumphy
article-published-date: "10/20/2021 11:10:07 PM"
version-number: 1
article-number: KA-17470
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=dc40aa30-fa31-ec11-b6e5-000d3a5ba97a"
exl-id: 534227cf-df15-4255-b699-e26953bf90e6
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '641'
ht-degree: 1%

---

# Fehler: Zu viele geöffnete Dateien

## Beschreibung

<br><br><br>Problem<br><br><br><br><br><br>
Die Protokolldateien enthalten den Fehler &quot;Zu viele Dateien&quot;und AEM reagiert nicht.
<br><br><br><br><br><br>Ursache<br><br><br><br><br><br>
Die Ursache ist eine von zwei Möglichkeiten:

- Die Anwendung schließt keine Ressourcen wie Dateien oder Sockets, nachdem sie sie verwendet hat.
- Oder die Anwendung erfordert mehr offene Dateien, als vom Prozess erlaubt sind.



## Auflösung

<br><br> <br><br><br><br><br><br>
Die Lösung dieses Problems ist:

1. Finden Sie heraus, was dazu führt, dass das Limit für geöffnete Dateien erreicht wird.
2. Erhöhen Sie entweder das Limit oder beheben Sie die Anwendungsfehler.

<br><br><br><br>Finden Sie heraus, welche Dateien oder Sockets offen gelassen wurden.<br><br> <br><br>
\*\* Beachten Sie, dass die Beschränkungen für offene Dateien für die Gesamtanzahl der kombinierten offenen Dateien, Pipelines und Sockets gelten, nicht nur für Dateien.

on [!DNL Linux] Plattform, `lsof` kann verwendet werden, um zu debuggen, welche Ressourcen vom Prozess geöffnet gehalten werden.

Hier finden Sie ein Beispielskript, das nützlich sein soll `lsof` Ausgabe:
<br><br><br><br><br> <br><br><br><br>

```
#!/bin/bash` `if` `$` `# -eq 0` `  ` `then` `    ` `echo` `"No PID specified"` `    ` `echo` `"Run command with PID, for example:"` `    ` `echo` `"lsof-script.sh 12345"` `    ` `exit` `2` `fi`<br>   <br>  `JAVA_PROCESS_PID=$1`<br>   <br>  `lsof` `-p $JAVA_PROCESS_PID` `lsof` `-output-$JAVA_PROCESS_PID.txt`<br>   <br>  `echo` `"Files open by the process:"` `cat` `lsof` `-output-$JAVA_PROCESS_PID.txt | ` `wc` `-l`<br>   <br>  `echo` `"Generated output file with counts of grouped open files lsof-sorted-counts-$JAVA_PROCESS_PID.txt"` `cat` `lsof` `-output-$JAVA_PROCESS_PID.txt |` `awk` `'{print $9}'` `|` `sed` `-e` `"s/\(.*\)\(segmentstore\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(repository/index\).*$/\1\2/"` `|` `sed` `-e` `"s/\(.*\)\(felix/bundle\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(/lib\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(/logs\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(/ext\).*$/\1\2/"` `|` `sort` `|` `uniq` `-c |` `sort` `-rn -k1` `lsof` `-sorted-counts-$JAVA_PROCESS_PID.txt`<br>   <br>  `echo` `"Total open files in OS:"` `lsof` `|` `wc` `-l` 
```


<br><br><br><br><br> <br><br>
Beispielausgabe:
<br><br><br><br><br> <br><br><br><br>

```
 $ ./lsof-script.sh 18070 Files open by the process:      1995 Generated output file with counts of grouped open files: lsof-sorted-counts-18070.txt Total open files in OS:     18399 
```

<br><br><br><br><br> <br><br>
Inspect die Ausgabe der generierten `lsof-sorted-counts-\*.txt` -Datei.  Sie zeigt an, welche Dateien oder Sockets derzeit vom Prozess offen gehalten werden.

Wenn Sie offene Sockets oder Dateien finden, die nicht geöffnet sein sollten, dann ist dies wahrscheinlich auf einen Anwendungsfehler zurückzuführen.  Aktualisieren Sie Ihren Anwendungs-Code, um Dateien und Sockets nach der Verwendung zu schließen.

Eine häufige Ursache für die anhaltenden offenen Sockets ist benutzerdefinierter Code, der einen Webdienst bereitstellt.  In vielen Fällen können Bibliotheken [!DNL Apache] [!DNL Commons HttpClient] verwendet wird, aber Verbindungen werden von den Entwicklern nie geschlossen.  Siehe [diesem Artikel](https://stackoverflow.com/questions/43454514/proper-usage-of-apache-httpclient-and-when-to-close-it) Einzelheiten zu [!DNL Apache] [!DNL Commons HttpClient].
<br><br><br><br> <br><br>Erhöhen Sie das Limit für die Shell-Sitzung<br><br><br><br> <br><br>
Überprüfen Sie das Limit des Benutzers auf maximal geöffnete Dateien und führen Sie dann Folgendes als derselbe Benutzer aus, als AEM Prozess ausgeführt wird:

`ulimit -Sn ulimit -Hn`

Wenn Sie das standardmäßige Startskript von AEM/CQ verwenden, führen Sie die folgenden Schritte aus, um das Limit zu erhöhen:

1. Öffnen Sie `crx-quickstart/bin/start` zur Bearbeitung
2. Variable hinzufügen `CQ_MAX_OPEN_FILES` am Anfang des Skripts:    `CQ_MAX_OPEN_FILES=8192 export CQ_MAX_OPEN_FILES`


Wenn der Fehler angezeigt wird `-bash: ulimit: open files: cannot modify limit: Operation not permitted` beim Starten von AEM funktioniert die oben beschriebene Konfiguration nicht.

Stattdessen ist es notwendig, die Beschränkung in `/etc/security/limits.conf`. Weitere Informationen zur Neukonfiguration des Benutzerlimits finden Sie unten.

Wenn Sie einen Anwendungsserver eines Drittanbieters verwenden, z. B. [!DNL JBoss] oder [!DNL Websphere]folgen Sie den folgenden Abschnitten und überprüfen Sie sie mit der Dokumentation des Anbieters.

Hinweis:

Wenn keine der Konfigurationen in diesem Artikel das Problem löst, überprüfen Sie, welche Dateien mit dem Befehl geöffnet sind. `lsof -p`. (`-p` ist die Prozess-ID des problematischen Prozesses.) Möglicherweise lässt Ihre Anwendung die Dateihandle offen. Wenn Sie sehen, dass die Handles hauptsächlich von AEM und nicht von Ihrer Anwendung gehalten werden, wenden Sie sich an den Support.


<br><br><br><br> <br><br>Erhöhen der Benutzergrenzen<br><br><br><br> <br><br>
Um die maximale Anzahl offener Dateien für Nicht-Root-Benutzer zu ändern, ändern Sie die Datei `/etc/security/limits.conf`. Sie können die Begrenzung für jeden Benutzer festlegen:

`crx_process_username soft nofile 8092`

`crx_process_username hard nofile 20000`

Hinweis:

Diese Konfiguration wird erst wirksam, wenn sich der Benutzer das nächste Mal anmeldet.


<br><br><br><br> <br><br>Systemgrenze erhöhen<br><br><br><br> <br><br>
Manchmal ist der Benutzergrenzwert hoch genug, aber das System selbst hat die maximale Anzahl von Dateien erreicht. Führen Sie Folgendes wie folgt aus: `su/root` user:

1. Überprüfen Sie die Einstellung für die maximal geöffnete Datei auf dem Betriebssystem (wenn sie unter 20000 liegt, ist es sinnvoll, diese Einstellung zu erhöhen).    `cat /proc/sys/fs/file-max`
2. Fügen Sie diese Zeile zu `/etc/sysctl.conf` , um den Maximalwert der geöffneten Datei des Systems zu erhöhen:    `fs.file-max = 300000`
3. Führen Sie diesen Befehl aus:    `sysctl -p`
4. Stellen Sie sicher, dass der neue Wert angezeigt wird, wenn Sie diesen Befehl ausführen:    `cat /proc/sys/fs/file-max`


Hinweis:

Diese Konfiguration wird erst wirksam, wenn sich der Benutzer das nächste Mal anmeldet.


<br><br><br><br> <br><br>Zusätzliche Informationen<br><br><br><br> <br><br>
Dieser Fehler tritt auf, wenn das System oder der Benutzer die maximale Anzahl an Dateiverarbeitungen verwendet.

HERUNTERLADEN
[Datei abrufen](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/TooManyOpenFiles/jcr:content/main-pars/kb_download/check_open_files.sh "check_open_files.sh") <br><br>Shell-Skript, das Sie verwenden können, um die Nutzung offener Dateien zu überwachen. Verwenden Sie dieses Skript nur, wenn der Fehler &quot;Zu viele geöffnete Dateien&quot;auch nach der Erhöhung des Maximalwerts weiter auftritt. Sie können es auch verwenden, wenn Sie vermuten, dass CRX oder Ihre Anwendung die Dateihandle offen lässt. Bevor Sie das Skript verwenden, konfigurieren Sie die folgenden Variablen: `JAVA_HOME`, `QUICKSTART_PATH`, `OUTPUT_DIR`, `USER`, `MAX_FILES_THRESHOLD`. Um das Skript zu verwenden, konfigurieren Sie es als Cron-Auftrag.
