---
title: Ausführen einer Einheitlichkeitsüberprüfung des Datenspeichers mit oak-run
description: Beschreibung
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Akash Kapoor
article-created-date: 4/3/2022 9:37:38 PM
article-published-by: Akash Kapoor
article-published-date: 4/3/2022 9:39:46 PM
version-number: 2
article-number: KA-19064
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=68a58547-96b3-ec11-983f-000d3a5d09d6
exl-id: 8aec0830-a1db-4e57-95e4-3745e87bde32
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '392'
ht-degree: 1%

---

# Ausführen einer Einheitlichkeitsüberprüfung des Datenspeichers mit oak-run

## Beschreibung

Die Konsistenzprüfung des Datenspeichers meldet alle Datenspeicher-Binärdateien, die fehlen, aber noch referenziert werden. Die Konsistenzprüfung kann direkt von der Felix-Konsole ausgelöst werden.<br>
Sie kann von MarkSweepGarbageCollector#checkConsistency Mbean ausgelöst werden

Wenn die BlobGC MBeans im MBeanServer registriert sind, kann auch das folgende MBean verwendet werden:

BlobGCMbean#checkConsistency

Nach Abschluss der Konsistenzprüfung zeigt eine Meldung die Anzahl der als fehlend gemeldeten Binärdateien an. Wenn die Zahl größer als 0 ist, überprüfen Sie die Protokolle, die für org.apache.jackrabbit.oak.plugins.blob .MarkSweepGarbageCollector konfiguriert wurden, um weitere Informationen zu den fehlenden Binärdateien zu erhalten.

Im Folgenden finden Sie ein Beispiel dafür, wie die fehlenden Binärdateien in den Protokollen aufgeführt werden:

`11:32:39.673 INFO main MarkSweepGarbageCollector.java:600 Consistency check found 1 missing blobs 11:32:39.673 WARN main MarkSweepGarbageCollector.java:602 Consistency check failure in the the blob store : DataStore backed BlobStore org.apache.jackrabbit.oak.plugins.blob.datastore.OakFileDataStore, check missing candidates in file /tmp/gcworkdir-1467352959243/gccand-1467352959243`

Im Gegensatz zur Benutzeroberfläche /system/console/repositorycheck prüft das oak-run-Tool die ausgeblendeten Lucene-Indexdateien unter /oak: -Index zusätzlich zum Rest der Inhaltspfade. Befehl &quot;datastorecheck&quot; <b>oak-run </b>kann verwendet werden, um eine Konsistenzprüfung am Datenspeicher durchzuführen.  Die detaillierten Schritte zum Ausführen des Befehls werden im Folgenden beschrieben:




## Auflösung


1. Laden Sie oak-run jar 1.8.8 oder höher auf Ihren AEM-Server herunter.
2. Platzieren Sie die Oak-Run-JAR-Datei im selben Ordner, in dem crx-quickstart platziert wird. Geben Sie andernfalls den vollständigen Pfad von oak-run-\*.jar an, während Sie unter dem Befehl ausgeführt werden.
3. Führen Sie den folgenden Befehl aus (aktualisieren Sie die Pfade zum Segmentspeicher und zum Datenspeicher gemäß Ihrer Umgebung):


`java -jar oak-run-*.jar datastorecheck --consistency --ref --id --fds crx-quickstart/install/org.apache.jackrabbit.oak.plugins.blob.datastore.FileDataStore.config --repoHome crx-quickstart/repository --store crx-quickstart/repository/segmentstore --dump temp --verbose --track`

4. Der -Befehl gibt eine Konsistenzprüfung des Datenspeichers aus.

Die Konsistenzprüfung für den DataStore kann auch verwendet werden, um alle Blob-Referenzen im Knotenspeicher und alle Blob-IDs im Datenspeicher aufzulisten. Verwenden Sie den folgenden Befehl:

`$ java-jar oak-run-*.jar datastorecheck --id --ref --consistency \`

`--store | \`

`--s3ds |--fds \`

`--dump \`

`--track`



Geben Sie eine oder mehrere der folgenden verfügbaren Optionen an:

—id - Listet alle IDs im Datenspeicher auf.

—ref - Listet alle Blob-Referenzen im Knotenspeicher auf.

—consistency - Auflistung aller fehlenden Blobs durch eine Konsistenzprüfung.



Die folgenden Optionen sind optional:

—store - Pfad zum Segmentspeicher von mongo uri (erforderlich für —ref und —consistency options oben).

—dump - Pfad, in dem die Dateien abgelegt werden sollen (optional). Andernfalls werden die Dateien im Ordner &quot;Benutzer-TMP&quot;abgelegt.

—s3ds - Pfad zur S3DataStore-Konfigurationsdatei.

—fds - Pfad zur FileDataStore-Konfigurationsdatei (&quot;path&quot;-Eigenschaft ist obligatorisch).

—track - Pfad des lokalen Repository-Stammordners (optional). Dadurch wird eine Kopie der heruntergeladenen Blob-IDs platziert, die verfolgt werden sollen.
