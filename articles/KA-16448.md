---
title: Migrieren von Benutzern, Gruppen und ACLs zwischen AEM Instanzen
description: Beschreibung
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: 'Helpx Link: https://helpx.adobe.com/experience-manager/kb/migrate-users-groups-ACLs.html ; Contains Docs links that may need to be changed'
bug: false
article-created-by: Gucci Paull
article-created-date: 6/21/2022 6:07:06 PM
article-published-by: Gucci Paull
article-published-date: 6/21/2022 6:07:59 PM
version-number: 8
article-number: KA-16448
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=d7ce3bf2-8cf1-ec11-bb3d-6045bd015716
exl-id: 5c285ad4-da35-4ee4-b3d1-3ac9eea5f5b2
source-git-commit: af761579c3fb5e51cf5f4d144bff0e058fd13911
workflow-type: tm+mt
source-wordcount: '960'
ht-degree: 1%

---

# Migrieren von Benutzern, Gruppen und ACLs zwischen AEM Instanzen

## Beschreibung

Migrieren von Benutzern und Gruppen mit ACL-Berechtigungen in AEM von einem Server auf einen anderen oder von einer AEM Instanz auf einen anderen.

## Auflösung

**Schritt 1: Admin und anonyme Benutzer suchen**

1. Rufen Sie die CRXDE Lite-App auf `/crx/de/index.jsp` und melden Sie sich als Administrator an (im Quellsystem).
1. Gehen Sie zu &quot;Tools&quot;= &quot;Abfrage&quot;.
1. Geben Sie im unteren Feld &quot;Abfrage&quot;diese Abfrage ein, um den Admin-Benutzer zu finden: *`/jcr:root/home/users//element(\*,rep:User)@rep:principalName="admin" .`*
1. Klicken Sie auf &quot;Ausführen&quot;und kopieren Sie den Pfad des Admin-Benutzerknotens in die Ergebnisse in eine Textdatei.
1. Wiederholen Sie Schritt 3 mit einer Abfrage für einen anonymen Benutzer: *`/jcr:root/home/users//element(\*,rep:User)@rep:principalName="anonymous" .`*
1. Klicken Sie auf &quot;Ausführen&quot;und kopieren Sie den Pfad des anonymen Benutzerknotens in die Ergebnisse in eine Textdatei (jetzt haben Sie also zwei Pfade: einen für &quot;Admin&quot;und einen für &quot;Anonym&quot;).

   Beispiel:

   `/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv` - Admin-Benutzer im Quellsystem

   `/home/users/K/Kj1406Qo9IDODc_nk5Ib` - anonymer Benutzer im Quellsystem

**Schritt 2A: Migrieren von Benutzern und Gruppen (mithilfe von `crx2oak` oder `oak-upgrade`)**

Benutzer und Gruppen können mithilfe der Variablen [crx2oak](https://helpx.adobe.com/experience-manager/6-4/sites/deploying/using/using-crx2oak.html) oder [oak-upgrade](https://jackrabbit.apache.org/oak/docs/migration.html) Tools.

1. Laden Sie die `crx2oak` oder `oak-upgrade` jar, das mit der verwendeten Oak-Version übereinstimmt: 
   1. Oak-Upgrade: [https://repo1.maven.org/maven2/org/apache/jackrabbit/oak-upgrade](https://repo1.maven.org/maven2/org/apache/jackrabbit/oak-upgrade)
   1. Crx2Oak: [Maven-Repository](https://mvnrepository.com/artifact/com.adobe.granite/crx2oak?repo=adobe-public)
1. Laden Sie die JAR-Datei auf den AEM-Server hoch.
1. Beenden AEM (Quell- und Zielinstanzen)
1. Ersetzen Sie den Namen der JAR-Datei im folgenden Befehl.
1. Ersetzen *`/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv,/home/users/K/Kj1406Qo9IDODc_nk5Ib`* im *`--exclude-paths`* Teil-Parameter des folgenden Befehls mit den Pfaden des Administrators und anonymer Benutzer von Ihrem Quellsystem aus.
1. Pfade online so ändern, dass sie mit Ihrer Instanz übereinstimmen (hinzufügen *`segment-old:`* vor dem Pfad, falls erforderlich, siehe hier . [https://jackrabbit.apache.org/oak/docs/migration.html](https://jackrabbit.apache.org/oak/docs/migration.html)): *`/opt/aem-source/crx-quickstart/repository /opt/aem-destination/crx-quickstart/repository`*
1. Führen Sie dann den Befehl auf der Shell des Servers aus.

   ```
   java -Xms2g -Xmx2g -jar oak-upgrade-1.8.12.jar \
   --include-paths=/home \
   --merge-paths=/home \
   --exclude-paths=/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv,/home/users/K/Kj1406Qo9IDODc_nk5Ib,/home/groups/a/administrators,/home/groups/a/analytics-administrators,/home/groups/c/community-moderators,/home/groups/c/content-authors,/home/groups/c/contributor,/home/groups/community/community-groupadmin,/home/groups/community/community-sitecontentmanager,/home/groups/community/community-sitemembers,/home/groups/d/dam-users,/home/groups/default/order-administrators,/home/groups/e/everyone,/home/groups/f/forms-users,/home/groups/forms/fd-administrators,/home/groups/forms/forms-users,/home/groups/geometrixx,/home/groups/media,/home/groups/o/operators,/home/groups/projects,/home/groups/t/tag-administrators,/home/groups/t/target-activity-authors,/home/groups/u/user-administrators,/home/groups/w/workflow-editors,/home/groups/w/workflow-users,/home/users/a/admin,/home/users/a/anonymous,/home/users/mac,/home/users/media,/home/users/projects,/home/users/system,/home/rep:policy,/home/users/rep:policy,/home/groups/rep:policy \
   segment-old:/opt/aem-source/crx-quickstart/repository /opt/aem-destination/crx-quickstart/repository  upgradeusers.log &
   ```

1. Gehen Sie nach Abschluss des Vorgangs zu Schritt 3, um die ACLs zu migrieren.  Wenn Sie nicht migrieren können mit `crx2oak` Führen Sie stattdessen die folgenden Schritte zur Package-Migration aus.

**Schritt 2B: Benutzer und Gruppen migrieren (mithilfe von Paketen)**

Wenn Benutzer nicht automatisch über LDAP/SAML-Authentifizierung importiert wurden oder `CRX2Oak` (Methode A oben) können Sie dann Benutzer und Gruppen verpacken.  In diesem Fall erstellen Sie zwei separate Pakete auf dem alten System (außer Admin und anonymen nativen Benutzern).

1. Kopieren Sie den Pfad der anonymen und Admin-Benutzerknoten aus den Ergebnissen aus Schritt 1 (&quot;Suchen Sie die Admin- und anonymen Benutzer&quot;) oben.

   Beispiel:

   `/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv` - Administratorbenutzer auf dem System, auf dem ich das Paket erstelle

   `/home/users/K/Kj1406Qo9IDODc_nk5Ib` - anonymer Benutzer auf dem System, auf dem ich das Paket erstelle

1. Wechseln Sie zum &quot;Package Manager&quot;, *`http://host:port/crx/packmgr/index.jsp`* und melden Sie sich als Administrator an.
1. Paket &quot;Benutzer&quot;erstellen
1. Fügen Sie einen Filter zur Package-Konfiguration für hinzu. `/home/users` mit diesen Ausschlussregeln (auf der `/home/users` filter):
   1. `exclude /home/users/.\*/.tokens`
   1. `exclude /home/users/Q/QY5FIMXeQIbGpwZtQ3Dv`
   1. `exclude /home/users/K/Kj1406Qo9IDODc_nk5Ib`
   1. `exclude /home/users/a/admin`
   1. `exclude /home/users/a/anonymous`
   1. `exclude /home/users/system`
   1. `exclude /home/users/geometrixx`
   1. `exclude /home/users/media`
   1. `exclude /home/users/projects`
   1. `exclude /home/users/mac`
1. Erstellen Sie das Paket.
1. Laden Sie das Paket herunter.
1. Entpacken Sie die ZIP-Datei des Pakets auf Ihrem Computer: `jar -xvf users.zip META-INF/vault/filter.xml`
1. Öffnen Sie die Datei `META-INF/vault/filter.xml` in einem Texteditor.
1. Hinzufügen `mode="merge"` zum Tag filter ... , z. B.:

   ```
   ?xml version="1.0" encoding="UTF-8"?    workspaceFilter version="1.0"    filter root="/home/users" mode="merge"    exclude pattern="/home/users/.*/.tokens"/    exclude pattern="/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv"/    exclude pattern="/home/users/K/Kj1406Qo9IDODc_nk5Ib"/    exclude pattern="/home/users/a/admin"/    exclude pattern="/home/users/a/anonymous"/    exclude pattern="/home/users/system"/    exclude pattern="/home/users/geometrixx"/    exclude pattern="/home/users/media"/    exclude pattern="/home/users/projects"/    exclude pattern="/home/users/mac"/    /filter    /workspaceFilter
   ```

1. Komprimieren Sie den geänderten Paketinhalt neu, sodass er die Änderung enthält.

   ```
   jar -uvf users.zip META-INF/vault/filter.xml
   ```

1. Erstellen eines Pakets &quot;Gruppen&quot;, das eine Filterregel enthält `/home/groups`.
1. Wiederholen Sie die Schritte 11 bis 14 für das Gruppenpaket.
1. (Nur Aktualisierung) Wenn Sie die Migration auf eine neuere AEM durchführen, installieren Sie eine neue lokale AEM-Instanz. *der alten Version*(mit nosamplecontent) und installieren Sie das Benutzerpaket und dann das Gruppenpaket dort. Führen Sie dann eine ersetzende Aktualisierung auf die neue Version auf dieser Instanz durch. Dadurch werden die Benutzer in die neue Oak-Darstellung konvertiert. Komprimieren Sie die Benutzer nach der ersetzenden Aktualisierung erneut, um sie auf die gewünschte aktualisierte Instanz zu portieren. Tun Sie dasselbe für die Benutzergruppen.
1. Installieren Sie das Benutzerpaket auf dem neuen System.
1. Installieren Sie das Gruppenpaket auf dem neuen System.
1. Wenn Sie von einer älteren AEM auf 6.3 migrieren, gehen Sie zu `/useradmin` Benutzeroberfläche und fügen Sie den Benutzerreplikations-Empfänger zur Gruppe &quot;Administratoren&quot;hinzu.

**Schritt 3. ACLs migrieren**

Wenn Sie Tools (ACS Commons) installieren können, um zu AEM, führen Sie die folgenden Schritte aus:

1. Laden Sie ACS Commons herunter und installieren Sie es.
1. Führen Sie die hier angegebenen Schritte aus, um ein ACL-Paket zu erstellen.
1. Gehen Sie zu http://aem-host:port/crx/packmgr/index.jsp and melden Sie sich als Administrator an.
1. Klicken Sie auf das ACL-Paket.
1. Klicken Sie auf Bearbeiten.
1. Wählen Sie die [!UICONTROL Erweitert] Registerkarte (siehe Screenshot unten).
1. Wählen Sie im Dropdown-Menü AC-Handhabung die Option [!UICONTROL Zusammenführen] um zu vermeiden, dass vorhandene ACLs im Zielsystem entfernt werden. Dies ist besonders wichtig bei der Migration von ACLs zwischen verschiedenen Versionen von AEM (da es verhindert, dass Out-of-the-Box-ACLs entfernt werden).

Wenn Sie *not* Sie können Tools (ACS Commons) installieren, um sie zu AEM. Führen Sie dann die folgenden Schritte aus. Beachten Sie, dass der Computer, auf dem Sie diese Befehle ausführen, Mac OS sein muss. [!DNL Linux]oder [!DNL Windows] (mithilfe von [!DNL Cygwin]) mit cURL, [!DNL Python]und [!DNL Java] SDK installiert.

1. Gehen Sie zu http://src-aem-host:port/crx/packmgr/index.jsp and melden Sie sich als Administrator an.
1. Erstellen Sie ein Paket mit dem Namen &quot;ACL-migration&quot;.
1. Klicken Sie auf die Schaltfläche Bearbeiten .
1. Wählen Sie die [!UICONTROL Erweitert] und legen Sie den AC-Handling-Modus auf &quot;Zusammenführen&quot;fest.
1. Speichern.
1. Erstellen Sie das Paket und laden Sie es herunter.
1. Führen Sie auf dem Dateisystem diesen Befehl auf dem Paket aus, um die `META-INF/vault/filter.xml` Datei: 

   ```
   jar -xvf ACL-migration-1.0.zip META-INF/vault/filter.xml
   ```

1. Führen Sie im selben Verzeichnis diesen Befehl aus, um eine JSON-Datei der ACL-Pfade unter herunterzuladen. `/content` aus der Quellinstanz (legen Sie den Benutzernamen und das Kennwort fest und korrigieren Sie den Host): 

   ```
   curl -u admin:admin 'http://aemhost/crx/de/query.jsp?' -G --data-urlencode '_dc=1507011481908&_charset_=utf-8&type=xpath&stmt=/jcr:root/content//element(*,rep:ACL)&showResults=true'  data.json
   ```

1. Datei erstellen `generate-package-filter.py` und fügen Sie die [!DNL Python] Code darunter: 

   ```
   import json
   from pprint import pprint
   
   with open ('data.json') as data_file:
      data = json.load(data_file)
   
   print("?xml version=\"1.0\" encoding=\"UTF-8\"?")
   print("workspaceFilter version=\"1.0\"")
   
   for item in data "results":
       print("filter root=\"{path}\" /" . format(path=item "path"))
   
   print( "/workspaceFilter")
   ```

1. Führen Sie die [!DNL Python] Skript aus dem Ordner, in dem data.json erstellt wurde, und speichern Sie die Ausgabe in `META-INF/vault/filter.xml` (ersetzt den vorhandenen Inhalt von `filter.xml`): 

   ```
   python generate-packge-filter.py  META-INF/vault/filter.xml
   ```

1. Verwenden Sie diesen Befehl, um die `filter.xml` in der ZIP-Datei:

   ```
   jar -uvf ACL-migration-1.0.zip META-INF/vault/filter.xml
   ```

1. Laden Sie die ZIP-Datei in den Paketmanager der Quellinstanz hoch: http://src-aem-host:port/crx/packmgr/index.jsp
1. Klicken [!UICONTROL Build] oder [!UICONTROL Neu erstellen] um das Paket zu erstellen.
1. Laden Sie das Paket vom Quell-AEM-Server herunter.
1. Laden Sie das Paket in den Paketmanager des Ziel-AEM-Servers hoch: http://dst-aem-host:port/crx/packmgr/index.jsp
1. Klicken [!UICONTROL Installieren] um es zu installieren.
1. Wiederholen Sie die Schritte 8 bis 16 für alle anderen Pfade, die den curl-Befehl des Pfads ändern. Dies würde beispielsweise die ACLs unter `/etc` anstelle von `/content`:

   ```
   curl -u admin:admin 'http://aemhost/crx/de/query.jsp?' -G --data-urlencode '_dc=1507011481908&_charset_=utf-8&type=xpath&stmt=/jcr:root/etc//element(*,rep:ACL)&showResults=true'  data.json` |
   ```
