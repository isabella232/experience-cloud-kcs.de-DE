---
title: "Thread-Sicherheitskopien von einer JVM übernehmen"
description: Beschreibung
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: „KCS“
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: "10/20/2021 6:41:42 PM"
article-published-by: Roxann McGlumphy
article-published-date: "10/20/2021 6:48:01 PM"
version-number: 1
article-number: KA-17452
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=2e54c459-d531-ec11-b6e5-000d3a5ba97a"
exl-id: 9ad0fefe-b974-45d9-95b6-4a90f691f0cb
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '1052'
ht-degree: 0%

---

# Thread-Sicherheitskopien aus einer JVM erstellen

## Beschreibung

<br><br><br>Wie kann ich Thread-Sicherheitskopien von einer JVM in [!DNL Linux], UNIX oder [!DNL Windows]?<br><br><br><br> <br><br>
Ein Thread-Dump ist eine Liste aller [!DNL Java] Threads, die derzeit in einem [!DNL Java Virtual Machine] (JVM).

Es gibt mehrere Möglichkeiten, Thread-Sicherheitskopien von einer JVM zu erstellen. Es wird dringend empfohlen, mehr als 1 Thread-Dump zu nehmen. Es empfiehlt sich, 10 Thread-Sicherheitskopien in einem regelmäßigen Intervall zu erstellen (z. B. eine Thread-Sicherheitskopie alle zehn Sekunden).


## Lösung

<br><br>Schritt 1: Abrufen der PID Ihres [!DNL Java] Prozess<br><br><br><br> <br><br>
Die erste Information, die Sie benötigen, um eine Thread-Sicherheitskopie zu erhalten, ist Ihre [!DNL Java] PID des Prozesses.

Die [!DNL Java] JDK wird mit dem Befehl jps geliefert, der alle [!DNL Java] Prozess-IDs. Sie können diesen Befehl wie folgt ausführen:


```
jps -l 70660 sun.tools.jps.Jps 70305
```


<b>Hinweis:</b> In [!DNL Linux] und UNIX müssen Sie diesen Befehl möglicherweise als `sudo -u user jps -l`, wobei &quot;user&quot;der Benutzername des Benutzers ist, der die [!DNL Java] Der -Prozess wird ausgeführt als.

Wenn dies nicht funktioniert oder Sie Ihre [!DNL Java] Prozess (Pfad nicht festgelegt, JDK nicht installiert oder älter) [!DNL Java] version), verwenden

- UNIX, [!DNL Linux]und Mac OS X: `ps -el | grep java`
- [!DNL Windows]: Drücken Sie Strg+Umschalt+Esc , um den Task-Manager zu öffnen und die PID der [!DNL Java] Prozess

<br><br><br><br><br><br>Schritt 2: Eine Thread-Sicherheitskopie von JVM anfordern<br><br><br><br><br><br><br><br>
<b>jstack</b>

Wenn die Variable installiert/verfügbar ist, wird empfohlen, die <b>jstack</b> -Tool. Es werden Thread-Sicherheitskopien an die Befehlszeilenkonsole gedruckt.

Führen Sie den folgenden Befehl aus, um mithilfe von jstack eine Thread-Sicherheitskopie zu erhalten:
`jstack -l pid`

Sie können aufeinander folgende Thread-Sicherheitskopien in einer Datei ausgeben, indem Sie die Umleitungs-/Anlagenrichtlinie für die Konsolenausgabe verwenden:
`jstack -l pid  threaddumps.log`

Hinweise:

- Das jstack-Tool ist seit JDK 1.5 verfügbar (für JVM unter [!DNL Windows], ist es nur in einigen Versionen von JDK 1.5 und JDK 1.6 verfügbar).
- jstack funktioniert auch dann, wenn die `-Xrs` jvm-Parameter ist aktiviert
- Es ist nicht möglich, das jstack-Tool von JDK 1.6 zu verwenden, um Thread-Dumps aus einem Prozess zu nehmen, der auf JDK 1.5 ausgeführt wird.
- In [!DNL Linux] und UNIX müssen Sie den Befehl als Benutzer ausführen, der Eigentümer des Java-Prozesses ist:

   `sudo -u *java-user* jstack -l *pid*`  

   (java-user sollte durch die ID des Benutzers ersetzt werden, der die [!DNL Java] Prozess wird wie folgt ausgeführt:)
- In [!DNL Windows], wenn Sie jstack ausführen und den Fehler &quot;Für die Verarbeitung dieses Befehls ist nicht genügend Speicher verfügbar&quot;erhalten, müssen Sie jstack als Windows SYSTEM-Benutzer oder den Benutzer ausführen, der Eigentümer des Java-Prozesses ist.  Sie können dies mithilfe von psexec tun, das Sie herunterladen können [here](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx). Um jstack als SYSTEM-Benutzer auszuführen, verwenden Sie einen Befehl wie den folgenden:

   `psexec -s jstack *pid*   threaddumps.log`

   Wenn Sie psexec nicht auf dem Server installieren können, können Sie eine .bat-Datei mit dem Befehl erstellen und ausführen [mithilfe der [!DNL Windows] Task Scheduler (als ein anderer Benutzer)](https://technet.microsoft.com/en-us/library/cc748993%28v=ws.11%29.aspx).
- Wenn der Java-Prozess nicht reagiert, kann es manchmal hilfreich sein, die Option zu verwenden <b>`-J-d64`</b> (auf 64-Bit-Systemen), z. B.:

   `jstack -J-d64 -l *pid*  threaddumps.log`
- Wenn der jstack-Befehl (`jstack -l pid  threaddumps.log`) gibt den Fehler 1 aus und führt dann den Befehl als Benutzer aus, der Eigentümer des Java-Prozesses ist.  Beispiel:

   `sudo -u sling jstack -l pid  threaddumps.log`



<br><br><br><br><br><br> <br><br><br><br>

```
Error attaching to process: sun.jvm.hotspot.debugger.DebuggerException: Can't attach to the process: ptrace(PTRACE_ATTACH, ..) failed for 22893: Operation not permitted

sun.jvm.hotspot.debugger.DebuggerException: sun.jvm.hotspot.debugger.DebuggerException: Can't attach to the process: ptrace(PTRACE_ATTACH, ..) failed for 22893: Operation not permitted

...

Caused by: sun.jvm.hotspot.debugger.DebuggerException: Can't attach to the process: ptrace(PTRACE_ATTACH, ..) failed for 22893: Operation not permitted

...

sun.jvm.hotspot.debugger.linux.LinuxDebuggerLocal$LinuxDebuggerLocalWorkerThread.run(LinuxDebuggerLocal.java:138)
```



<br><br>JSTACK-SKRIPT<br><br>
Hier ist ein [script](https://github.com/cqsupport/jstackSeries.sh/blob/master/jstackSeries.sh) (angepasst von der [eclipse.org](http://wiki.eclipse.org/How_to_report_a_deadlock#jstackSeries_--_jstack_sampling_in_fixed_time_intervals_.28tested_on_Linux.29)), die eine Reihe von Thread-Sicherheitskopien mit jstack benötigt.  Es nimmt auch die CPU-Nutzung auf Thread-Ebene mithilfe des obersten Befehls ein.

Führen Sie es einfach wie folgt aus:
`sudo -u *user*jstackSeries.sh *pid* *aemserveruser* *count* *delay*`

Beispiel:
`sudo -u aemuser jstackSeries.sh 1234 aemserveruser 10 3`

- <b>1234</b> ist die PID der [!DNL Java] Prozess
- <b>cq5serveruser</b> ist die [!DNL Linux] oder UNIX-Benutzer, der [!DNL Java] Prozess läuft als
- <b>10</b> wie viele Thread-Sicherheitskopien benötigt werden
- <b>3</b> ist die Verzögerung zwischen den einzelnen Ablagerungen


<b>Hinweis: </b>Die oberste Ausgabe hat die native Thread-ID im Dezimalformat, während die Jstack-Ausgabe die NID im Hexadezimalformat hat.  Sie können den hohen CPU-Thread von der oberen Ausgabe zur jstack-Ausgabe abgleichen, indem Sie die Thread-ID in hexadezimal konvertieren.

Zusätzlich zum obigen Skript haben wir auch eine ähnliche [[!DNL Windows] Powershell-Skript und Adobe AEM Skript auf github](https://github.com/cqsupport/jstackSeries.sh).

<b>Thread-Sicherungswerkzeug für Adobe Experience Manager</b>

Wenn Sie Adobe Experience Manager-Produkt verwenden, können Sie [dieses Tool](https://helpx.adobe.com/experience-manager/kb/thread-dumps-collection-analysis.html) , um eine einfache Benutzeroberfläche zum Generieren von Thread-Sicherheitskopien zu haben.
<br><br>ALTERNATIVE MÖGLICHKEITEN ZUM ABRUFEN EINES THREAD-DUMPS<br><br>
Wenn die Variable <b>jstack</b> nicht verfügbar ist, können Sie Thread-Sicherheitskopien wie folgt erstellen:

<b>Hinweis:</b> Einige Tools können keine Thread-Sicherheitskopien von der JVM verwenden, wenn der Befehlszeilenparameter `-Xrs` aktiviert ist. Wenn Sie Probleme beim Erstellen von Thread-Sicherheitskopien haben, überprüfen Sie, ob diese Option aktiviert ist.
<br><br>UNIX, Mac OS X und [!DNL Linux] (JDK 1.4 oder weniger)<br><br>
Unter UNIX, Mac OS X und [!DNL Linux], können Sie ein QUIT-Signal an die [!DNL Java] -Prozess, um ihn anzuweisen, einen Thread-Dump an die Standardausgabe auszugeben.

1. Führen Sie dazu diesen Befehl aus:

   `kill -QUIT *pid*`

   Möglicherweise müssen Sie diesen Befehl als `sudo -u user kill -QUIT *pid*` wobei &quot;user&quot;der Benutzer ist, der die [!DNL Java] Der -Prozess wird ausgeführt als.
2. Wenn Sie CQSE mit der `crx-quickstart/server/start` Skript verwenden, werden Ihre Thread-Sicherheitskopien in `crx-quickstart/server/logs/startup.log`. Wenn Sie einen Anwendungsserver eines Drittanbieters wie JBoss verwenden, [!DNL WebSphere], [!DNL Tomcat]Informationen dazu, zu welcher Datei die Standardausgabe geleitet wird, finden Sie in der Dokumentation des Servers.

[!DNL Windows]:<br><br>JDK 1.X
1. Laden Sie javadump.exe herunter (angehängt unten).
2. Starten Sie die JVM mit diesen drei Argumenten (sie müssen in der richtigen Reihenfolge sein):

   `-XX:+UnlockDiagnosticVMOptions -XX:+LogVMOutput -XX:LogFile=*C:\temp\jvmoutput.log*`
3. Drücken Sie Strg+Umschalt+Esc , um den Task Manager zu öffnen.
4. Suchen Sie die PID der [!DNL Java] Prozess.
5. Führen Sie in der Befehlszeile

   `javadump.exe *pid*`
6. Die Thread-Sicherheitskopie wird im `jvmoutput.log` -Datei, die in Schritt 2 erwähnt wird.

<br><br>JDK 1.6<br><br>
Abrufen einer Thread-Sicherheitskopie von <b>jconsole</b> mithilfe eines Plug-ins: 0

So können Sie eine Thread-Sicherheitskopie anfordern:

1. Fügen Sie den folgenden Parameter zur JVM hinzu, die ausgeführt wird `Communique` : `-Dcom.sun.management.jmxremote`
2. Laden Sie JDK 1.6 herunter und installieren Sie es (falls noch nicht geschehen).
3. Laden Sie die [Thread Dump Analyzer-Dienstprogramm](https://github.com/irockel/tda). 1
4. Ausführen `jconsole.exe` von JDK 1.6:

                               `jconsole.exe -pluginpath /path/to/file/tda.jar`
5. Klicken Sie auf <b>Thread-Sicherheitskopien</b> Registerkarte.
6. Klicken Sie auf <b>Thread-Sicherungskopie anfordern</b> Link.

<b>Hinweis:</b> Wenn Sie AEM 6 ausführen.\* und die laufenden Threads beobachten möchten, können Sie `http://host:port/system/console/status-Threads` um eine Thread-Liste zu erhalten. Beachten Sie jedoch, dass diese Thread-Dumps nicht mit Thread-Dump-Analyse-Tools wie Samurai oder tda funktionieren.<br><br>Gilt für<br><br>
Alle Adobe-Produkte, die in einer JVM ausgeführt werden
<br><br>Analyse-Tools für Thread-Sicherheitskopien:<br><br>
0 [http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx)
1  [https://github.com/irockel/tda](https://github.com/irockel/tda)
2 [https://fastthread.io/](https://fastthread.io/)
3 [https://www.ibm.com/support/knowledgecenter/en/SSLLVC_5.0.0/com.ibm.esupport.tool.tmda.doc/docs/readme.htm](https://www.ibm.com/support/knowledgecenter/en/SSLLVC_5.0.0/com.ibm.esupport.tool.tmda.doc/docs/readme.htm)
