---
title: SMPP-Protokollanalyse mithilfe von [!DNL Wireshark]
description: Beschreibung
solution: Campaign
product: Campaign
applies-to: Campaign Classic
keywords: KCS, SMPP, Wireshark
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Craig Thonis
article-created-date: 5/6/2022 3:51:03 PM
article-published-by: Craig Thonis
article-published-date: 5/6/2022 3:52:19 PM
version-number: 4
article-number: KA-17506
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=9319e64e-54cd-ec11-a7b5-6045bd00d4f5
exl-id: 39c89da2-36ae-4c66-9553-cfc3d5b4003a
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '2415'
ht-degree: 5%

---

# SMPP-Protokollanalyse mithilfe von [!DNL Wireshark]

## Beschreibung

<br>Erfahren Sie, wie Sie den SMPP-Traffic mithilfe von [!DNL Wireshark].<br><br><br><br><br>Einführung<br><br><br><br> <br><br>
Die meisten SMS-C mit hohem Durchsatz sind mit dem SMPP-Protokoll Version 3.4 kompatibel. Dieses Protokoll ermöglicht den Versand von SMS und den Empfang von Informationen über den Versand dieser SMS. Das SMPP-Protokoll ist in der SMPP Protocol Specification v3.4 dokumentiert, die im Internet als PDF-Dokument verfügbar ist.

Dieser Artikel ersetzt diese Spezifikation nicht: Es gibt praktische Tipps, wie die Protokollspezifikation interpretiert und mit der [!DNL Wireshark] angezeigt, um Probleme zwischen Adobe Campaign und dem SMS-C-Partner zu beheben.

Da das SMPP-Protokoll viele verschiedene Teile enthält, die der Interpretation des Implementierungsteams überlassen bleiben, gibt es Unterschiede zwischen verschiedenen SMS-C.

Wenden Sie sich bei der Problembehebung immer an den SMS-C-Partner, um Informationen zu erhalten oder um zu überprüfen, was Sie erhalten. Wenn SMS-C mit einem Fehler antwortet, wird Ihr SMS-C-Partner Ihnen am besten mitteilen, warum er mit dem Fehler geantwortet hat. Wenn Sie einen SMPP-Simulator verwenden, anstatt eine Verbindung zu einem echten SMS-C herzustellen, sollten Sie den Quellcode (oder einen Debugger) verwenden, um zu verstehen, was passiert.


## Auflösung

<br><br>Erfassen des Netzwerk-Traffics ohne [!DNL Wireshark]<br><br><br><br><br><br>
Wenn Sie keinen direkten Zugriff auf den Computer haben, kann es erforderlich sein, mithilfe von Befehlszeilen-Tools wie *tcpdump*. Wenn Sie bereits den TCP-Port der Verbindung kennen, stellen Sie den richtigen Filter ein, um zu vermeiden, dass der gesamte Traffic erfasst wird. Hier finden Sie ein Beispiel `tcpdump` Befehlszeile zum Erfassen des Anschlusses `12345` nach <b>`outfile.pcap`</b>:


| `tcpdump -i any -w outfile.pcap tcp port 12345` |
| --- |


Die Datei <b>`outfile.pcap`</b> kann dann in geöffnet werden [!DNL Wireshark] für weitere Analysen.


<br><br>[!DNL Wireshark] Handhabung<br><br><br><br> <br><br><br><br>
Bei diesem Thema wird davon ausgegangen, dass Sie mit den Grundlagen von [!DNL Wireshark]: Packages erfassen, einfache Filter definieren, Paketdetails lesen. Eine kurze Einführung finden Sie unter [howtogeek - Verwendung [!DNL Wireshark] zum Erfassen, Filtern und Inspect-Paketen](https://www.howtogeek.com/104278/how-to-use-wireshark-to-capture-filter-and-inspect-packets/).

So filtern Sie den SMPP-Traffic in [!DNL Wireshark], gibt es drei wichtige Funktionen:

- Verwenden Sie einen Anzeigefilter für den Anschluss der SMS-C. Wenn beispielsweise die SMS-C den Port verwendet `10000`verwenden Sie den folgenden Filter:
   *`tcp.port == 10000`*


Um Pakete nach Telefonnummer oder Textinhalt zu isolieren, verwenden Sie die Suchfunktion mit den folgenden Einstellungen:
![smpp1](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image/smpp1.png "smpp1")
- Verwenden Sie die <b>TCP-Stream</b> -Tool zum Isolieren des Streams, an dem Sie arbeiten.
Schließen Sie das rote/blaue Textfenster, das angezeigt wird, da es nur für Textprotokolle nützlich ist, die für SMPP nicht relevant sind.
   ![smpp2](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_964579199/smpp2.png "smpp2")



<br><br><br><br>SMPP-Protokoll<br><br> <br><br>
Das Protokoll funktioniert über TCP und ist vollständig binär, was bedeutet, dass spezielle Tools wie [!DNL Wireshark] (oder ein Hexadezimaleditor) erforderlich sind, um den Inhalt des Streams zu entschlüsseln.

Der Stream besteht aus unabhängigen PDUs: Jede PDU ist eine Nachricht mit einem Befehl, einem Status, einer Sequenznummer und anderen Informationen, die auf dem Befehl basieren.

Aufgrund der Natur von TCP als Stream-Protokoll kann ein TCP-Paket mehr als eine PDU enthalten, und PDUs können über 2 oder mehr TCP-Pakete umfassen. [!DNL Wireshark] verwendet PDUs korrekt neu, sodass sie für die [!DNL Wireshark] Benutzer.

Im Folgenden finden Sie ein Beispiel für PDUs, die beim Senden eines MT und anschließendem Empfangen eines SR durch das Netzwerk geleitet werden:
![smpp3](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_388497282/smpp3.png "smpp3")
Hinweis:

Die Liste der Standardbefehle finden Sie in Abschnitt 5.1.2.1 der SMPP-Spezifikation (SMPP-Befehlssatz).
<br><br><br><br><br><br>SMPP-Antworten<br><br><br><br> <br><br>
Das SMPP-Protokoll erfordert, dass alle Befehle von einer Antwort-PDU quittiert werden:

`BIND_TRANSMITTER` wird von *`BIND_TRANSMITTER_RESP`*, *`SUBMIT_SM`* wird von *`SUBMIT_SM_RESP`*, usw.

Es gibt eine Zeitüberschreitung für Antworten, normalerweise 10, 30 oder 60 Sekunden. Die Antwort kann eine positive Bestätigung (`command _status = 0`) oder einen Fehler (siehe 5.1.3) *`command_status`*, *Tabelle 5-2* in der SMPP-Spezifikation für die Liste der Standardfehler). Meistens sind diese Antworten sofort und ein Antwort-Timeout wird nicht erreicht.

Achten Sie darauf, zwischen SMPP-Antwortfehlern und SR-Fehlercodes zu unterscheiden: derselbe Fehlercode kann im Antwortfehler oder im SR-Fehlerfeld unterschiedliche Bedeutungen haben. Bei der Meldung eines Fehlercodes müssen Sie sehr vorsichtig sein, wo Sie ihn gefunden haben, da die Bedeutung des Werts vom Kontext abhängt.
<br><br><br><br><br><br>SMPP-Verbindungsinitialisierung<br><br><br><br><br><br>
Die SMPP-Verbindung beginnt mit der Verbindung über TCP. Dann ein `BIND` -Vorgang wird gesendet von [!DNL Campaign]durch `BIND RESP`. Diese Vorgänge werden in Abschnitt 4.1 der SMPP-Spezifikation (`BIND` -Vorgang).
![smpp4](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_468626174/smpp4.png "smpp4")
Der Bindungsvorgang führt die Login-/Kennwortprüfung durch und tauscht Informationen über den Plattformnamen, die Version und andere in der Spezifikation beschriebene Felder aus.

Hinweis:

Die Anmeldung finden Sie im Abschnitt `system_id` -Feld.



In [!DNL Campaign], sollte eine *`BIND_TRANSMITTER`* Paket beim Initiieren einer MT-Übertragung und einer *`BIND_RECEIVER`* packet when *`nlsm s`* Trigger eine MO/SR-Verbindung.

<b>Sender, Empfänger und Transceiver: </b>Der SMPP-Connector für Campaign Classic funktioniert in einem separaten Sender-/Empfängermodus: Es gibt zwei TCP-Verbindungen, eine zum Senden von MT und eine andere zum Empfangen von MO und SR. Beachten Sie, dass die TCP-Verbindung immer von [!DNL Campaign], auch für den Empfängermodus.

SMPP bietet auch einen Transceiver-Modus. Dieser Modus wird jedoch zum Campaign Classic nicht im SMPP-Connector implementiert.

Der SMPP-Connector verwendet mehrere parallele Verbindungen, um MT zu übertragen. Dies kann aufgrund der Art und Weise, wie der Connector entwickelt wurde, nicht gesteuert werden.
<br><br><br><br><br><br>Empfangen von MO<br><br><br><br><br><br>
Wenn der Empfänger gebunden ist, kann die SMS-C MO jederzeit senden. Der MO wird mithilfe einer *`DELIVER_SM`* PDU mit Bits 2-5 von *`esm_clas s`* clear (oft) *`esm_class`* ist einfach 0).
![smpp5](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_695769115/smpp5.png "smpp5")
Die *`DELIVER_SM`* PDU muss schnell von einem *`DELIVER_SM_RESP`* PDU mit dem gleichen *`sequence_number`*.
<br><br><br><br><br><br>Sendet MT<br><br><br><br><br><br>
Um einen MT zu senden, muss der Transmitter erfolgreich gebunden sein. Prüfen Sie vor allem, ob der Bindungsprozess erfolgreich durchgeführt wurde.

Der MT wird in einer *`SUBMIT_SM`* PDU. SMS-C sollte schnell mit einer *`SUBMIT_SM_RESP`* PDU: Dieses Antwortpaket ist besonders, da es die Kennung der Nachricht in der Datenbank der SMS-C enthält (immer diese Kennung bei Gesprächen mit dem SMS-C-Partner angeben, damit er die Nachricht schneller finden kann). Diese ID ist im SR enthalten und ist die einzige Möglichkeit, den MT mit dem entsprechenden SR abzugleichen.

Das Feld *`registered_delivery`* (siehe Abschnitt 5.2.17 der Spezifikation) gibt dem SMS-C an, ob für diesen MT ein SR angefordert wird. Wenn Sie für eine bestimmte Nachricht keinen SR erhalten, überprüfen Sie, ob das Feld in der *`SUBMIT_SM`* PDU.
![smpp5](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_1891077095/smpp5.png "smpp5")<br><br><br><br><br><br>Kodierung von MT<br><br><br><br><br><br>
Vorsicht:

Die SMS-Kodierung ist ein komplexes Thema mit vielen Fallen und verschiedenen Implementierungen.


<br><br><br><br> <br><br>
Bei Kodierungsproblemen ist es empfehlenswert, sich stets an den SMS-C-Partner zu wenden. Ihr SMS-Partner verfügt über genaue Kenntnisse der unterstützten Kodierung und speziellen Regeln, die aufgrund von Einschränkungen in seiner technischen Plattform angewendet werden können. Lassen Sie sie überprüfen, was Sie ihnen senden und was sie Ihnen zurückschicken, es ist der einzige Weg zu einer erfolgreichen und stabilen Verbindung.

SMS-Nachrichten verwenden eine spezielle 7-Bit-Kodierung, die oft GSM7-Kodierung genannt wird. Siehe [!DNL Wikipedia] GSM 03.38 (auf Englisch).
<br><br><br><br> <br><br>
Im SMPP-Protokoll wird der GSM7-Text auf 8 Bit pro Zeichen erweitert, um die Fehlerbehebung zu erleichtern. Das SMS-C packt es in 7 Bit pro Zeichen, bevor es an das Mobiltelefon gesendet wird. Das bedeutet, dass das Feld short_message der SMS im SMPP-Frame bis zu 160 Byte lang sein kann, während es beim Versand im Mobilfunknetz auf 140 Byte begrenzt ist (das bedeutendste Bit wird einfach verworfen).

Bei Kodierungsproblemen sollten Sie Folgendes überprüfen:

- Stellen Sie zunächst sicher, dass Sie wissen, welche Zeichen zu welcher Kodierung gehören. GSM7 ist berüchtigt für seine teilweise Unterstützung diakritischer Zeichen (Akzente). Besonders im Französischen, wo é und è zu GSM7 gehören, ê, â oder ï aber nicht. Die Situation in Bezug auf Spanisch ist nicht besser.
- Das C mit Cedilla (ç) ist nur in Großbuchstaben im GSM7-Alphabet vorhanden, aber einige Telefone geben es in Kleinbuchstaben oder &quot;Smart&quot;-Groß-/Kleinschreibung wieder: Die allgemeine Empfehlung besteht darin, dies vollständig zu vermeiden und den Cedilla zu entfernen (er ist auf Französisch noch sehr lesbar) oder zu UCS-2 zu wechseln.
- Verwenden Sie ASCII nicht in SMS, es sei denn, dies wird vom SMS-C-Partner ausdrücklich verlangt: Diese Kodierung verschwendet Speicherplatz, da sie 8-Bit-Zeichen und eine geringere Abdeckung als GSM7 aufweist.
- Latin-1 wird nicht immer unterstützt: Prüfen Sie die Kompatibilität mit Ihrem SMS-C-Partner, bevor Sie versuchen, Latin-1 zu verwenden.
- Nationale Sprachverschiebungstabellen werden vom Adobe Campaign Classic-Connector nicht unterstützt. Sie müssen stattdessen UCS-2 verwenden.
- UCS-2 und UTF-16 werden oft per Telefon gemischt. Dies ist ein Problem für Personen, die Emoji und andere selten verwendete Zeichen senden, die nicht in UCS-2 vorhanden sind.
- Die GSM7-Kodierung wird nicht von [!DNL Wireshark]: Sonderzeichen werden falsch angezeigt. Wenn Sie überprüfen müssen, ob eine GSM7-Zeichenfolge korrekt kodiert ist, müssen Sie Hexadezimalcodes mit der GSM7-Tabelle vergleichen.


Die *`data_coding`* gibt an, welche Kodierung verwendet wird. Das einzige Problem besteht darin, dass der Wert 0 die standardmäßige SMS-C-Kodierung in der Spezifikation bedeutet, im Allgemeinen aber GSM7. Überprüfen Sie mit dem SMS-C *Partner, mit welcher Kodierung verbunden ist. `data_coding = 0` (Adobe Campaign unterstützt nur GSM7 für `data_coding* = 0`).

Die maximale Größe einer Nachricht hängt von ihrer Kodierung ab. In dieser Tabelle sind alle relevanten Informationen zusammengefasst:
<br><br><br><br> <br>

| Codierung | data_coding | Nachrichtengröße (Zeichen)  | Größe der Teile für mehrteilige SMS  | Verfügbare Zeichen  |
| --- | --- | --- | --- | --- |
| GSM7 | 0 | 160 | 152 | [GSM7-Grundzeichensatz + Erweiterung](https://en.wikipedia.org/wiki/GSM_03.38) (erweiterte Zeichen benötigen 2 Zeichen)  |
| Latin-1  | 3 | 140 | 134 | ISO-8859-1 |
| UCS-2 UTF-16  | 8 | 70 | 67 | Unicode (variiert von Telefon zu Telefon) |

<br><br><br><br><br>User Data Header (UDH)<br><br><br><br><br><br>
UDH (User Data Header) sind kleine binäre Kopfzeilen, die zum Text einer SMS hinzugefügt werden. Sie können spezielle Funktionen wie SMS-Verkettung, nationale Sprachverschiebungstabellen, Logos/Bilder (selten verwendet) oder WAP-Push-Benachrichtigungen Trigger haben.

Da die UDH Teil des Textfelds ist (Feld short_message SMPP ), verkürzt sie die effektive Größe einer SMS. Beispielsweise verbraucht ein verkettetes SMS-UDH 6 Byte pro SMS-Teil (d. h. 6 echte 8-Bit-Bytes, nicht 7-Bit-Zeichen), sodass genügend Platz für nur 152 7-Bit-Zeichen pro Nachrichtenteil bleibt.

[!DNL Wikipedia] hat nette Artikel über User Data Header und verkettete SMS (in englischer Sprache).

Um herauszufinden, ob eine short_message eine UDH enthält, überprüfen Sie die Bits 6 und 7 von esm_class (siehe Abschnitt 5.2.12 der Spezifikation). [!DNL Wireshark] analysiert UDH in der -Oberfläche und liefert genaue Informationen.
![smpp7](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_738682084/smpp7.png "smpp7")
Im obigen Screenshot können Sie den Header der Benutzerdaten im Nachrichtenfeld (1), die in der UDH enthaltenen Informationen (2) und einige zusätzliche Informationen sehen, die nicht zum Paket gehören, aber von [!DNL Wireshark] 3. Das Feld Kurznachrichten-Hauptteil ist besonders interessant, da es die vollständige Nachricht enthält, die von [!DNL Wireshark].
<br><br><br><br><br><br>Empfangsbestätigung<br><br><br><br><br><br>
Wenn der Empfänger gebunden ist, kann SMS-C jederzeit SR senden. Der SR wird mit einer DELIVER_SM-PDU mit den Bits 2-5 von * gesendet`esm_class`*festgelegt.
![smpp8](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_158644074/smpp8.png "smpp8")
Die *`DELIVER_SM`* PDU muss schnell von einem *`DELIVER_SM_RESP`* PDU mit dem gleichen *`sequence_number`*. Suchen Sie den MT, der diesem SR entspricht, nach einer *`SUBMIT_SM_RESP`* mit derselben ID. Dies ist beispielsweise der MT, der mit dem SR übereinstimmt:
![smpp9](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_1012110897/smpp9.png "smpp9")
SR werden nur gesendet, wenn die *`registered_delivery`* im MT festgelegt ist.

Hinweis:

Adobe Campaign Classic SMPP-Connector verarbeitet keine SR, die vor dem *`SUBMIT_SM_RESP`* Paket. Die Spezifikation verbietet dieses Verhalten nicht explizit, wird jedoch als schlechtes Verhalten betrachtet (d. h., die Nachricht wurde empfangen, bevor sie gesendet wurde). Wenn Sie diesen Fall zu oft feststellen, bitten Sie Ihren SMS-C-Partner, seine Plattform zu reparieren.
<br><br><br><br><br><br>Entschlüsseln des Felds short_message des SR<br><br><br><br><br><br>
Das Textfeld der SR-PDUs verfügt über eine spezielle Kodierung, die in Anhang B der SMPP-Protokollspezifikation beschrieben ist. Leider ist dieses Format nur eine Empfehlung, ohne Teil des Protokolls zu sein, obwohl die meisten SMS-C mehr oder weniger dieses Format respektieren.

Sie sollten den SMS-C-Partner direkt um eine Dokumentation seiner eigenen Implementierung bitten und überprüfen, ob sie mit dem übereinstimmt, was Sie in [!DNL Wireshark]. In den meisten Fällen kennen SMS-C-Implementoren nicht einmal ihre Implementierung und dies führt zu Problemen und Missverständnissen. Fragen Sie den SMS-C-Partner um Hilfe, wenn Sie Zweifel an diesem Feld haben (insbesondere an den Fehlercodes).

Das Grundformat lautet wie folgt:

*`id:IIIIIIIIII sub:SSS dlvrd:DDD submit date:YYMMDDhhmm done date:YYMMDDhhmm stat:DDDDDDD err:EEE`*

*`Text:........`*

Dies sind allgemeine Richtlinien für die Lektüre der obigen Zeile:

- Die ID ist die gleiche, die im * gesendet wurde.`SUBMIT_SM_RESP`*des entsprechenden MT.
- Sie können Probleme im `text` -Feld: Dieses Feld wird von [!DNL Campaign] weil sie nutzlos, unzuverlässig und sogar völlig unlesbar ist, wenn die SMS mit einer anderen Kodierung als reinem alphanumerischen ASCII gesendet wurde. Dies ist ein normales Verhalten.
- Bei Feldnamen wird nicht zwischen Groß- und Kleinschreibung unterschieden (z. B. `id`: `sub`: `Text`: kann auch wie folgt angegeben werden: `ID`: `SUB`: `text`:).
- Die *`dlvrd`*Feld ist im Allgemeinen nicht zuverlässig, es sei denn, es wird von dem SMS-C-Partner dokumentiert.
- Die Daten können eine Zeitzone haben, die sie praktisch nutzlos macht, oder sie sind einfach falsch, weil die Uhr des Remote-Servers ausgeschaltet ist.
- Die *`stat`*Das Feld kann andere als die in Anlage B definierten Werte aufweisen. Verwenden Sie den gesunden Menschenverstand und die Dokumentation des SMSC-Partners, um dessen Bedeutung zu verstehen.
- Die *`err`*Das Feld hängt vollständig von der SMS-C ab, die meistens vom SMS-C-Partner dokumentiert wird. Oft bedeutet der Code 000 einen Erfolg, während jeder andere Code Fehler anzeigt. Das Feld ist häufig numerisch, kann aber auch hexadezimal sein.

<br><br><br><br><br><br>Mehrere SR für denselben MT<br><br><br><br><br><br>
Einige SMS-C senden mehrere SR für denselben MT, um den Fortgang des MT im Netzwerk zu verfolgen. Dies ist zumeist nutzlos, da der Kunde in den meisten Fällen nur wissen möchte, wann die Nachricht empfangen wurde (dies ist normalerweise der letzte SR).

Im Zweifelsfall sollten Sie nur den neuesten SR bearbeiten, der von der SMS-C empfangen wurde, um den Status einer Nachricht zu ermitteln.
<br><br><br><br><br><br>SMPP-Fenster<br><br><br><br><br><br>
Da Vorgänge und Antworten asynchron sind, können Sie Übertragungsraten optimieren, indem Sie mehrere Vorgangs-PDUs senden, bevor Sie auf die Antworten warten. Die Anzahl der Nachrichten ohne Antwort wird als Fenster bezeichnet.

Beispiel einer Übertragung mit einem maximalen Fenster von 4:
![smpp10](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_2072040949/smpp10.png "smpp10")
Die aktuelle Implementierung kontrolliert das Fenster nicht und erwartet, dass das Remote-SMS-C für die Handhabung von MT schnell genug ist.
