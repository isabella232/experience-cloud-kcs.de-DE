---
title: SMPP-Protokollanalyse mithilfe von  [!DNL Wireshark]
description: Beschreibung
solution: Campaign
product: Campaign
applies-to: Campaign Classic
keywords: KCS, SMPP, Wireshark
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Craig Thonis
article-created-date: 5/6/2022 3:51:03 PM
article-published-by: Craig Thonis
article-published-date: 5/6/2022 3:52:19 PM
version-number: 4
article-number: KA-17506
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=9319e64e-54cd-ec11-a7b5-6045bd00d4f5
exl-id: 39c89da2-36ae-4c66-9553-cfc3d5b4003a
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '2415'
ht-degree: 100%

---

# SMPP-Protokollanalyse mithilfe von [!DNL Wireshark]

## Beschreibung

<br>Erfahren Sie, wie Sie den SMPP-Traffic mithilfe von [!DNL Wireshark] analysieren können.<br><br><br><br><br>Einführung<br><br><br><br> <br><br>
Die meisten SMS-C mit hohem Durchsatz sind mit dem SMPP-Protokoll Version 3.4 kompatibel. Dieses Protokoll ermöglicht den Versand von SMS und den Empfang von Informationen über den Versand dieser SMS. Das SMPP-Protokoll ist in der SMPP Protocol Specification v3.4 dokumentiert, die im Internet als PDF-Dokument verfügbar ist.

Dieser Artikel ersetzt diese Spezifikation nicht: Er gibt praktische Tipps, wie die Protokollspezifikation zu interpretieren und mit der [!DNL Wireshark]-Anzeige abzugleichen ist, um die Fehlersuche zwischen Adobe Campaign und dem SMS-C-Partner zu erleichtern.

Da das SMPP-Protokoll viele verschiedene Teile enthält, die der Interpretation des Implementierungsteams überlassen bleiben, gibt es Unterschiede zwischen verschiedenen SMS-C.

Wenden Sie sich bei der Problembehebung immer an den SMS-C-Partner, um Informationen zu erhalten oder um zu überprüfen, was Sie erhalten. Wenn SMS-C mit einem Fehler antwortet, kann Ihr SMS-C-Partner Ihnen am besten mitteilen, warum es mit dem Fehler geantwortet hat. Wenn Sie einen SMPP-Simulator verwenden, anstatt eine Verbindung zu einem echten SMS-C herzustellen, sollten Sie den Quellcode (oder einen Debugger) verwenden, um zu verstehen, was passiert.


## Lösung

<br><br>Erfassen des Netzwerk-Traffics ohne [!DNL Wireshark]<br><br><br><br><br><br>
Wenn Sie keinen direkten Zugriff auf den Computer haben, kann es erforderlich sein, den Traffic mithilfe von Befehlszeilen-Tools wie *tcpdump* zu erfassen. Wenn Sie bereits den TCP-Port der Verbindung kennen, stellen Sie den richtigen Filter ein, um zu vermeiden, dass der gesamte Traffic erfasst wird. Hier finden Sie eine Beispiel-`tcpdump`-Befehlszeile zum Erfassen des Ports `12345` in <b>`outfile.pcap`</b>:


| `tcpdump -i any -w outfile.pcap tcp port 12345` |
| --- |


Die Datei <b>`outfile.pcap`</b> kann dann in [!DNL Wireshark] zur weiteren Analysen geöffnet werden.


<br><br>[!DNL Wireshark]-Handhabung<br><br><br><br> <br><br><br><br>
Bei diesem Thema wird davon ausgegangen, dass Sie mit den Grundlagen von [!DNL Wireshark] vertraut sind: Pakete erfassen, einfache Filter definieren, Paketdetails lesen. Eine kurze Einführung finden Sie unter [howtogeek – Verwendung [!DNL Wireshark]  zum Erfassen, Filtern und Untersuchen von Paketen](https://www.howtogeek.com/104278/how-to-use-wireshark-to-capture-filter-and-inspect-packets/).

Um SMPP-Verkehr in [!DNL Wireshark] herauszufiltern, gibt es drei wichtige Funktionen:

- Verwenden Sie einen Anzeigefilter für den Port des SMS-C.
Wenn beispielsweise das SMS-C den Port `10000` nutzt, verwenden Sie den folgenden Filter:
   *`tcp.port == 10000`*


Um Pakete nach Telefonnummer oder Textinhalt zu isolieren, verwenden Sie die Suchfunktion mit den folgenden Einstellungen:
![smpp1](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image/smpp1.png "smpp1")
- Verwenden Sie das <b>TCP-Stream</b>-Tool zum Isolieren des Streams, an dem Sie arbeiten.
Schließen Sie das rote/blaue Textfenster, das angezeigt wird, da es nur für Textprotokolle nützlich ist, die für SMPP nicht relevant sind.
   ![smpp2](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_964579199/smpp2.png "smpp2")



<br><br><br><br>SMPP-Protokoll<br><br> <br><br>
Das Protokoll funktioniert über TCP und ist vollständig binär, was bedeutet, dass spezielle Tools wie [!DNL Wireshark] (oder ein Hexadezimaleditor) erforderlich sind, um den Inhalt des Streams zu entschlüsseln.

Der Stream besteht aus unabhängigen PDUs: Jede PDU ist eine Nachricht mit einem Befehl, einem Status, einer Sequenznummer und anderen Informationen, die auf dem Befehl basieren.

Aufgrund der Natur von TCP als Stream-Protokoll kann ein TCP-Paket mehr als eine PDU enthalten, und PDUs können 2 oder mehr TCP-Pakete umfassen. [!DNL Wireshark] stellt PDUs korrekt neu zusammen, sodass es für die [!DNL Wireshark]-Benutzer transparent ist.

Im Folgenden finden Sie ein Beispiel für PDUs, die beim Senden eines MT und anschließendem Empfangen eines SR durch das Netzwerk geleitet werden:
![smpp3](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_388497282/smpp3.png "smpp3")
Hinweis:

Die Liste der Standardbefehle finden Sie in Abschnitt 5.1.2.1 der SMPP-Spezifikation (SMPP-Befehlssatz).
<br><br><br><br><br><br>SMPP-Antworten<br><br><br><br> <br><br>
Das SMPP-Protokoll erfordert, dass alle Befehle von einer Antwort-PDU quittiert werden:

`BIND_TRANSMITTER` wird von *`BIND_TRANSMITTER_RESP`* quittiert, *`SUBMIT_SM`* wird von *`SUBMIT_SM_RESP`* quittiert usw.

Es gibt eine Zeitüberschreitung für Antworten, normalerweise 10, 30 oder 60 Sekunden. Die Antwort kann eine positive Bestätigung (`command _status = 0`) oder einen Fehler (siehe 5.1.3 *`command_status`*, *Tabelle 5-2* in der SMPP-Spezifikation für die Liste der Standardfehler) enthalten. In den meisten Fällen erfolgen diese Antworten sofort und es wird keine Zeitüberschreitung beim Antworten erreicht.

Achten Sie darauf, zwischen SMPP-Antwortfehlern und SR-Fehlercodes zu unterscheiden: derselbe Fehlercode kann im Antwortfehler oder im SR-Fehlerfeld unterschiedliche Bedeutungen haben. Wenn Sie einen Fehlercode melden, müssen Sie sehr genau darauf achten, wo Sie ihn gefunden haben, denn die Bedeutung des Wertes hängt von seinem Kontext ab.
<br><br><br><br><br><br>SMPP-Verbindungsinitialisierung<br><br><br><br><br><br>
Die SMPP-Verbindung beginnt mit der Verbindung über TCP. Dann wird ein `BIND`-Vorgang von [!DNL Campaign] gesendet und von einem `BIND RESP` quittiert. Diese Vorgänge werden in Abschnitt 4.1 der SMPP-Spezifikation (`BIND` -Vorgang) beschrieben.
![smpp4](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_468626174/smpp4.png "smpp4")
Der Bindungsvorgang führt die Anmelde-/Kennwortprüfung durch und tauscht Informationen über den Plattformnamen, die Version und andere in der Spezifikation beschriebene Felder aus.

Hinweis:

Die Anmeldung finden Sie im Feld `system_id`.



In [!DNL Campaign] sollten Sie ein *`BIND_TRANSMITTER`*-Paket sehen, wenn eine MT-Übertragung eingeleitet wird, und ein *`BIND_RECEIVER`*-Paket, wenn *`nlsm s`* eine MO/SR-Verbindung auslöst.

<b>Sender, Empfänger und Transceiver: </b>Der SMPP-Connector für Campaign Classic funktioniert in einem separaten Sender-/Empfängermodus: Es gibt zwei TCP-Verbindungen, eine zum Senden von MT und eine andere zum Empfangen von MO und SR. Beachten Sie, dass die TCP-Verbindung immer von [!DNL Campaign] eingeleitet wird, auch für den Empfängermodus.

SMPP bietet auch einen Transceiver-Modus. Dieser Modus wird jedoch für Campaign Classic nicht im SMPP-Connector implementiert.

Der SMPP-Connector verwendet mehrere parallele Verbindungen, um MT zu übertragen. Dies kann aufgrund der Art und Weise, wie der Connector entwickelt wurde, nicht gesteuert werden.
<br><br><br><br><br><br>Empfangen von MO<br><br><br><br><br><br>
Wenn der Empfänger gebunden ist, kann das SMS-C MO jederzeit senden. Das MO wird mit einer *`DELIVER_SM`*-PDU gesendet, bei der die Bits 2–5 von *`esm_clas s`* gelöscht sind (oft ist *`esm_class`* einfach 0).
![smpp5](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_695769115/smpp5.png "smpp5")
Auf die *`DELIVER_SM`*-PDU muss schnell von einer *`DELIVER_SM_RESP`*-PDU mit der gleichen *`sequence_number`* geantwortet werden.
<br><br><br><br><br><br>Senden von MT<br><br><br><br><br><br>
Um ein MT zu senden, muss der Sender erfolgreich gebunden sein. Prüfen Sie vor allem, ob der Bindungsprozess erfolgreich durchgeführt wurde.

Das MT wird in einer *`SUBMIT_SM`*-PDU gesendet. Das SMS-C sollte schnell mit einer *`SUBMIT_SM_RESP`*-PDU antworten: Dieses Antwortpaket ist besonders, weil es die ID der Nachricht in der Datenbank des SMS-C enthält (geben Sie diese ID immer an, wenn Sie mit dem SMS-C-Partner sprechen, damit er die Nachricht schneller findet). Diese ID ist im SR enthalten und ist die einzige Möglichkeit, das MT dem entsprechenden SR zuzuordnen.

Das Feld *`registered_delivery`* (beschrieben im Abschnitt 5.2.17 der Spezifikation) gibt dem SMS-C an, ob für dieses bestimmte MT ein SR angefragt wird. Wenn Sie für eine bestimmte Nachricht kein SR erhalten, überprüfen Sie, ob das Feld in der *`SUBMIT_SM`*-PDU korrekt eingestellt ist..
![smpp5](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_1891077095/smpp5.png "smpp5")<br><br><br><br><br><br>Kodierung von MT<br><br><br><br><br><br>
Achtung:

Die SMS-Kodierung ist ein komplexes Thema mit vielen Fallstricken und verschiedenen Implementierungen.


<br><br><br><br> <br><br>
Bei Kodierungsproblemen ist es stets empfehlenswert, sich an den SMS-C-Partner zu wenden. Ihr SMS-Partner verfügt über genaue Kenntnisse der unterstützten Kodierung und speziellen Regeln, die aufgrund von Einschränkungen in seiner technischen Plattform angewendet werden können. Lassen Sie ihn überprüfen, was Sie ihm senden und was er Ihnen zurückschickt, es ist der einzige Weg zu einer erfolgreichen und stabilen Verbindung.

SMS-Nachrichten verwenden eine spezielle 7-Bit-Kodierung, die oft GSM7-Kodierung genannt wird. Siehe [!DNL Wikipedia] GSM 03.38 (auf Englisch).
<br><br><br><br> <br><br>
Im SMPP-Protokoll wird der GSM7-Text auf 8 Bit pro Zeichen erweitert, um die Fehlerbehebung zu erleichtern. Das SMS-C packt ihn in 7 Bit pro Zeichen, bevor es an das Mobilgerät gesendet wird. Das bedeutet, dass das Feld „short_message“ der SMS im SMPP-Rahmen bis zu 160 Byte lang sein kann, während es beim Versand über das Mobilfunknetz auf 140 Byte begrenzt ist (das höchstwertige Bit wird einfach verworfen).

Bei Kodierungsproblemen sollten Sie Folgendes überprüfen:

- Stellen Sie zunächst sicher, dass Sie wissen, welche Zeichen zu welcher Kodierung gehören. GSM7 ist berüchtigt für seine nur teilweise Unterstützung diakritischer Zeichen (Akzente). Besonders im Französischen, wo é und è zu GSM7 gehören, ê, â oder ï aber nicht. Die Situation in Bezug auf Spanisch ist nicht besser.
- Das C mit Zedille (ç) ist im GSM7-Alphabet nur in Großbuchstaben vorhanden, aber einige Telefone geben es in Kleinbuchstaben oder „intelligenter“ Großschreibung wieder: die allgemeine Empfehlung ist, es ganz zu vermeiden und die Zedille zu entfernen (es ist im Französischen immer noch sehr gut lesbar) oder zu UCS-2 zu wechseln.
- Verwenden Sie kein ASCII in SMS, es sei denn, der SMS-C-Partner verlangt dies ausdrücklich: Diese Kodierung verschwendet Platz, da sie 8-Bit-Zeichen und eine geringere Abdeckung als GSM7 hat.
- Latin-1 wird nicht immer unterstützt: Fragen Sie bei Ihrem SMS-C-Partner nach der Kompatibilität, bevor Sie versuchen, Latin-1 zu verwenden.
- Nationale Sprachverschiebungstabellen werden vom Adobe Campaign Classic-Connector nicht unterstützt. Sie müssen stattdessen UCS-2 verwenden.
- UCS-2 und UTF-16 werden oft per Telefon gemischt. Dies ist ein Problem für Personen, die Emojis und andere selten verwendete Zeichen senden, die nicht in UCS-2 vorhanden sind.
- Die GSM7-Kodierung wird von [!DNL Wireshark] nicht unterstützt: Sonderzeichen werden falsch angezeigt. Wenn Sie überprüfen müssen, ob eine GSM7-Zeichenfolge korrekt kodiert ist, müssen Sie Hexadezimalcodes mit der GSM7-Tabelle vergleichen.


Das Feld *`data_coding`* gibt an, welche Kodierung verwendet wird. Das einzige Problem ist, dass der Wert 0 in der Spezifikation für die SMS-C-Standardkodierung steht, im Allgemeinen aber für GSM7. Erkundigen Sie sich beim SMS-C-*Partner, welche Kodierung mit `data_coding = 0` verbunden ist (Adobe Campaign unterstützt für `data_coding* = 0` nur GSM7).

Die maximale Größe einer Nachricht hängt von ihrer Kodierung ab. In dieser Tabelle sind alle relevanten Informationen zusammengefasst:
<br><br><br><br> <br>

| Codierung | data_coding | Nachrichtengröße (Zeichen)  | Größe der Teile für mehrteilige SMS  | Verfügbare Zeichen  |
| --- | --- | --- | --- | --- |
| GSM7 | 0 | 160 | 152 | [GSM7-Standardzeichensatz + Erweiterung](https://de.wikipedia.org/wiki/GSM_03.38) (Erweiterte Zeichen benötigen 2 Zeichen)  |
| Latin-1  | 3 | 140 | 134 | ISO-8859-1 |
| UCS-2 UTF-16  | 8 | 70 | 67 | Unicode (variiert von Telefon zu Telefon) |

<br><br><br><br><br>User Data Header (UDH)<br><br><br><br><br><br>
UDH (User Data Header) sind kleine binäre Kopfzeilen, die zum Text einer SMS hinzugefügt werden. Sie können besondere Funktionen wie SMS-Verkettung, nationale Sprachverschiebungstabellen, Logos/Bilder (selten verwendet) oder WAP-Push auslösen.

Da der UDH Teil des Textfelds ist (SMPP-Feld „short_message“), verkürzt er die effektive Größe einer SMS. Beispielsweise verbraucht ein verketteter SMS-UDH 6 Byte pro SMS-Teil (d. h. 6 echte 8-Bit-Bytes, nicht 7-Bit-Zeichen), sodass nur für 152 7-Bit-Zeichen genügend Platz pro Nachrichtenteil bleibt.

In [!DNL Wikipedia] finden Sie nette Artikel über User Data Header und verkettete SMS (in englischer Sprache).

Um herauszufinden, ob „short_message“ einen UDH enthält, überprüfen Sie die Bits 6 und 7 von „esm_class“ (siehe Abschnitt 5.2.12 der Spezifikation). [!DNL Wireshark] analysiert UDH in der Oberfläche und liefert genaue Informationen.
![smpp7](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_738682084/smpp7.png "smpp7")
Im obigen Screenshot sehen Sie den User Data Header im Nachrichtenfeld (1), die im UDH enthaltenen Informationen (2) und einige zusätzliche Informationen, die nicht zum Paket gehören, aber von [!DNL Wireshark] berechnet werden (3): Das Feld „Short Message body“ ist besonders interessant, da es die vollständige, von [!DNL Wireshark] neu zusammengesetzte Nachricht enthält.
<br><br><br><br><br><br>Empfangen von SR<br><br><br><br><br><br>
Wenn der Empfänger gebunden ist, kann das SMS-C SR jederzeit senden. Das SR wird mit einer DELIVER_SM-PDU gesendet, bei der die Bits 2–5 auf *`esm_class`* gesetzt sind.
![smpp8](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_158644074/smpp8.png "smpp8")
Auf die *`DELIVER_SM`*-PDU muss schnell von einer *`DELIVER_SM_RESP`*-PDU mit der gleichen *`sequence_number`* geantwortet werden. Um das MT zu finden, das dieser SR entspricht, suchen Sie nach einem *`SUBMIT_SM_RESP`* mit der gleichen ID. Dies ist beispielsweise das MT, der mit dem das SR übereinstimmt:
![smpp9](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_1012110897/smpp9.png "smpp9")
SR werden nur gesendet, wenn das Feld *`registered_delivery`* im MT festgelegt ist.

Hinweis:

Der Adobe Campaign Classic SMPP-Connector verarbeitet keine SR, die vor dem *`SUBMIT_SM_RESP`*-Paket ankommen. Die Spezifikation verbietet dieses Verhalten nicht ausdrücklich, aber es wird als schlechtes Verhalten angesehen (es würde bedeuten, dass die Nachricht empfangen wurde, bevor sie gesendet wurde). Wenn Sie diesen Fall zu oft feststellen, bitten Sie Ihren SMS-C-Partner, seine Plattform zu reparieren.
<br><br><br><br><br><br>Entschlüsseln des Felds „short_message“ des SR<br><br><br><br><br><br>
Das Textfeld der SR-PDUs verfügt über eine spezielle Kodierung, die in Anhang B der SMPP-Protokollspezifikation beschrieben ist. Leider ist dieses Format nur eine Empfehlung und nicht Teil des Protokolls, auch wenn die meisten SMS-C mehr oder weniger genau dieses Format einhalten.

Sie sollten den SMS-C-Partner direkt um eine Dokumentation seiner eigenen Implementierung bitten und überprüfen, ob sie mit dem übereinstimmt, was Sie in [!DNL Wireshark] sehen. Oftmals kennen die SMS-C-Implementierer nicht einmal ihre eigene Implementierung, was zu Problemen und Missverständnissen führt. Fragen Sie den SMS-C-Partner um Hilfe, wenn Sie Zweifel bezüglich dieses Felds haben (insbesondere wegen der Fehlercodes).

Das Grundformat lautet wie folgt:

*`id:IIIIIIIIII sub:SSS dlvrd:DDD submit date:YYMMDDhhmm done date:YYMMDDhhmm stat:DDDDDDD err:EEE`*

*`Text:........`*

Dies sind allgemeine Leitlinien für das Lesen der obigen Zeile:

- Die ID ist die gleiche, die im *`SUBMIT_SM_RESP`* des entsprechenden MT gesendet wurde.
- Probleme im Feld `text` können Sie ignorieren: Dieses Feld wird von [!DNL Campaign] ignoriert, weil es nutzlos und unzuverlässig ist und sogar völlig unlesbar sein kann, wenn die SMS in einer anderen Kodierung als reinem alphanumerischen ASCII gesendet wurde. Dies ist ein normales Verhalten.
- Bei Feldnamen wird nicht zwischen Groß- und Kleinschreibung unterschieden (z. B. kann `id`: `sub`: `Text`: auch wie folgt angegeben werden: `ID`: `SUB`: `text`:).
- Das Feld *`dlvrd`* ist im Allgemeinen nicht zuverlässig, es sei denn, es wurde von dem SMS-C-Partner dokumentiert.
- Die Datumsangaben können eine beliebige Zeitzone haben, was sie praktisch unbrauchbar macht, oder sie sind schlichtweg falsch, weil die Uhr des entfernten Servers falsch geht.
- Das Feld *`stat`* kann andere als die in Anlage B definierten Werte aufweisen. Nutzen Sie Ihren gesunden Menschenverstand und die Dokumentation des SMSC-Partners, um die Bedeutung zu verstehen.
- Das Feld *`err`* hängt vollständig vom SMS-C ab. Es wird meistens vom SMS-C-Partner dokumentiert. Oft bedeutet der Code 000 einen Erfolg, während jeder andere Code Fehler anzeigt. Das Feld ist häufig numerisch, kann aber auch hexadezimal sein.

<br><br><br><br><br><br>Mehrere SR für dasselbe MT<br><br><br><br><br><br>
Einige SMS-C senden mehrere SR für dasselbe MT, um den Fortschritt des MT im Netzwerk zu verfolgen. Dies ist zumeist nutzlos, da der Client in den meisten Fällen nur wissen möchte, wann die Nachricht empfangen wurde (dies ist in der Regel das letzte SR).

Im Zweifelsfall sollten Sie nur das letzte vom SMS-C empfangene SR verwenden, um den Status einer Nachricht zu ermitteln.
<br><br><br><br><br><br>SMPP-Fenster<br><br><br><br><br><br>
Da Vorgänge und Antworten asynchron sind, können Sie Übertragungsraten optimieren, indem Sie mehrere Vorgangs-PDUs senden, bevor Sie auf die Antworten warten. Die Anzahl der Nachrichten ohne Antwort wird als Fenster bezeichnet.

Beispiel einer Übertragung mit einem maximalen Fenster von 4:
![smpp10](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_2072040949/smpp10.png "smpp10")
Die aktuelle Implementierung kontrolliert das Fenster nicht und erwartet, dass das Remote-SMS-C für die Handhabung von MT schnell genug ist.
